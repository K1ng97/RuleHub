{
  "id": "5687f942-867b-4578-ade7-1e341c46e99a",
  "name": "VMToolsd Suspicious Child Process",
  "description": "Detects suspicious child process creations of VMware Tools process which may indicate persistence setup",
  "source": {
    "type": "sigma",
    "id": "5687f942-867b-4578-ade7-1e341c46e99a",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_vmware_vmtoolsd_susp_child_process.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_vmware_vmtoolsd_susp_child_process.yml"
  },
  "tags": [
    "attackexecution",
    "attackpersistence",
    "attackt1059"
  ],
  "author": "bohops, Bhabesh Raj",
  "references": [
    "https://bohops.com/2021/10/08/analyzing-and-detecting-a-vmtools-persistence-technique/",
    "https://user-images.githubusercontent.com/61026070/136518004-b68cce7d-f9b8-4e9a-9b7b-53b1568a9a94.png",
    "https://github.com/vmware/open-vm-tools/blob/master/open-vm-tools/tools.conf"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2021-10-08",
  "modified": "2023-07-25",
  "mitre": {
    "tactics": [
      "TA1059"
    ],
    "techniques": []
  },
  "detection": {
    "query": "selection_parent: {\"ParentImage|endswith\": \"\\\\vmtoolsd.exe\"}\nselection_img: [{\"Image|endswith\": [\"\\\\cmd.exe\", \"\\\\cscript.exe\", \"\\\\mshta.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\wscript.exe\"]}, {\"OriginalFileName\": [\"Cmd.Exe\", \"cscript.exe\", \"MSHTA.EXE\", \"PowerShell.EXE\", \"pwsh.dll\", \"REGSVR32.EXE\", \"RUNDLL32.EXE\", \"wscript.exe\"]}]\nfilter_main_vmwaretools_script: {\"Image|endswith\": \"\\\\cmd.exe\", \"CommandLine|contains\": [\"\\\\VMware\\\\VMware Tools\\\\poweron-vm-default.bat\", \"\\\\VMware\\\\VMware Tools\\\\poweroff-vm-default.bat\", \"\\\\VMware\\\\VMware Tools\\\\resume-vm-default.bat\", \"\\\\VMware\\\\VMware Tools\\\\suspend-vm-default.bat\"]}\nfilter_main_empty: {\"Image|endswith\": \"\\\\cmd.exe\", \"CommandLine\": \"\"}\nfilter_main_null: {\"Image|endswith\": \"\\\\cmd.exe\", \"CommandLine\": null}",
    "condition": "all of selection* and not 1 of filter_main_*",
    "fields": []
  },
  "falsepositives": [
    "Legitimate use by VM administrator"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}