{
  "id": "a7c3d773-caef-227e-a7e7-c2f13c622329",
  "name": "Bad Opsec Defaults Sacrificial Processes With Improper Arguments",
  "description": "Detects attackers using tooling with bad opsec defaults.\nE.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.\nOne trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.\n",
  "source": {
    "type": "sigma",
    "id": "a7c3d773-caef-227e-a7e7-c2f13c622329",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_susp_bad_opsec_sacrificial_processes.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_susp_bad_opsec_sacrificial_processes.yml"
  },
  "tags": [
    "attackdefense-evasion",
    "attackt1218011"
  ],
  "author": "Oleg Kolesnikov @securonix invrep_de, oscd.community, Florian Roth (Nextron Systems), Christian Burkard (Nextron Systems)",
  "references": [
    "https://blog.malwarebytes.com/malwarebytes-news/2020/10/kraken-attack-abuses-wer-service/",
    "https://www.cobaltstrike.com/help-opsec",
    "https://twitter.com/CyberRaiju/status/1251492025678983169",
    "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/regsvr32",
    "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/rundll32",
    "https://learn.microsoft.com/en-us/dotnet/framework/tools/regasm-exe-assembly-registration-tool",
    "https://learn.microsoft.com/en-us/dotnet/framework/tools/regsvcs-exe-net-services-installation-tool"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "experimental",
  "created": "2020-10-23",
  "modified": "2024-08-15",
  "mitre": {
    "tactics": [
      "TA1218"
    ],
    "techniques": [
      "T011"
    ]
  },
  "detection": {
    "query": "selection_werfault: {\"Image|endswith\": \"\\\\WerFault.exe\", \"CommandLine|endswith\": \"WerFault.exe\"}\nselection_rundll32: {\"Image|endswith\": \"\\\\rundll32.exe\", \"CommandLine|endswith\": \"rundll32.exe\"}\nselection_regsvcs: {\"Image|endswith\": \"\\\\regsvcs.exe\", \"CommandLine|endswith\": \"regsvcs.exe\"}\nselection_regasm: {\"Image|endswith\": \"\\\\regasm.exe\", \"CommandLine|endswith\": \"regasm.exe\"}\nselection_regsvr32: {\"Image|endswith\": \"\\\\regsvr32.exe\", \"CommandLine|endswith\": \"regsvr32.exe\"}\nfilter_optional_edge_update: {\"ParentImage|contains\": \"\\\\AppData\\\\Local\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\{\", \"Image|endswith\": \"\\\\rundll32.exe\", \"CommandLine|endswith\": \"rundll32.exe\"}\nfilter_optional_chromium_installer: {\"ParentImage|contains\": [\"\\\\AppData\\\\Local\\\\BraveSoftware\\\\Brave-Browser\\\\Application\\\\\", \"\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\\"], \"ParentImage|endswith\": \"\\\\Installer\\\\setup.exe\", \"ParentCommandLine|contains\": \"--uninstall \", \"Image|endswith\": \"\\\\rundll32.exe\", \"CommandLine|endswith\": \"rundll32.exe\"}",
    "condition": "1 of selection_* and not 1 of filter_optional_*",
    "fields": []
  },
  "falsepositives": [
    "Unlikely"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}