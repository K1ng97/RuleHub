{
  "id": "e4a6b256-3e47-40fc-89d2-7a477edd6915",
  "name": "System File Execution Location Anomaly",
  "description": "Detects the execution of a Windows system binary that is usually located in the system folder from an uncommon location.\n",
  "source": {
    "type": "sigma",
    "id": "e4a6b256-3e47-40fc-89d2-7a477edd6915",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_susp_system_exe_anomaly.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_susp_system_exe_anomaly.yml"
  },
  "tags": [
    "attackdefense-evasion",
    "attackt1036"
  ],
  "author": "Florian Roth (Nextron Systems), Patrick Bareiss, Anton Kutepov, oscd.community, Nasreddine Bencherchali (Nextron Systems)",
  "references": [
    "https://twitter.com/GelosSnake/status/934900723426439170",
    "https://asec.ahnlab.com/en/39828/"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "experimental",
  "created": "2017-11-27",
  "modified": "2024-07-16",
  "mitre": {
    "tactics": [
      "TA1036"
    ],
    "techniques": []
  },
  "detection": {
    "query": "selection: {\"Image|endswith\": [\"\\\\atbroker.exe\", \"\\\\audiodg.exe\", \"\\\\bcdedit.exe\", \"\\\\bitsadmin.exe\", \"\\\\certreq.exe\", \"\\\\certutil.exe\", \"\\\\cmstp.exe\", \"\\\\conhost.exe\", \"\\\\consent.exe\", \"\\\\cscript.exe\", \"\\\\csrss.exe\", \"\\\\dashost.exe\", \"\\\\defrag.exe\", \"\\\\dfrgui.exe\", \"\\\\dism.exe\", \"\\\\dllhost.exe\", \"\\\\dllhst3g.exe\", \"\\\\dwm.exe\", \"\\\\eventvwr.exe\", \"\\\\logonui.exe\", \"\\\\LsaIso.exe\", \"\\\\lsass.exe\", \"\\\\lsm.exe\", \"\\\\msiexec.exe\", \"\\\\ntoskrnl.exe\", \"\\\\powershell_ise.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\runonce.exe\", \"\\\\RuntimeBroker.exe\", \"\\\\schtasks.exe\", \"\\\\services.exe\", \"\\\\sihost.exe\", \"\\\\smartscreen.exe\", \"\\\\smss.exe\", \"\\\\spoolsv.exe\", \"\\\\svchost.exe\", \"\\\\taskhost.exe\", \"\\\\Taskmgr.exe\", \"\\\\userinit.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\", \"\\\\winver.exe\", \"\\\\wlanext.exe\", \"\\\\wscript.exe\", \"\\\\wsl.exe\", \"\\\\wsmprovhost.exe\"]}\nfilter_main_generic: {\"Image|startswith\": [\"C:\\\\$WINDOWS.~BT\\\\\", \"C:\\\\$WinREAgent\\\\\", \"C:\\\\Windows\\\\SoftwareDistribution\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SystemTemp\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\uus\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\"]}\nfilter_optional_system32: {\"Image|contains\": \"\\\\SystemRoot\\\\System32\\\\\"}\nfilter_main_powershell: {\"Image\": [\"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\"]}\nfilter_main_wsl_windowsapps: {\"Image|startswith\": \"C:\\\\Program Files\\\\WindowsApps\\\\MicrosoftCorporationII.WindowsSubsystemForLinux\", \"Image|endswith\": \"\\\\wsl.exe\"}",
    "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}