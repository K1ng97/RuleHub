{
  "id": "152f3630-77c1-4284-bcc0-4cc68ab2f6e7",
  "name": "Shell Open Registry Keys Manipulation",
  "description": "Detects the shell open key manipulation (exefile and ms-settings) used for persistence and the pattern of UAC Bypass using fodhelper.exe, computerdefaults.exe, slui.exe via registry keys (e.g. UACMe 33 or 62)",
  "source": {
    "type": "sigma",
    "id": "152f3630-77c1-4284-bcc0-4cc68ab2f6e7",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/registry_event_shell_open_keys_manipulation.yml",
    "file_path": "tmp/repos/sigma/rules/windows/registry/registry_event/registry_event_shell_open_keys_manipulation.yml"
  },
  "tags": [
    "attackdefense-evasion",
    "attackprivilege-escalation",
    "attackt1546001",
    "attackt1548002"
  ],
  "author": "Christian Burkard (Nextron Systems)",
  "references": [
    "https://github.com/hfiref0x/UACME",
    "https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/",
    "https://github.com/RhinoSecurityLabs/Aggressor-Scripts/tree/master/UACBypass",
    "https://tria.ge/211119-gs7rtshcfr/behavioral2 [Lokibot sample from Nov 2021]"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2021-08-30",
  "modified": "2022-01-13",
  "mitre": {
    "tactics": [
      "TA1546",
      "TA1548"
    ],
    "techniques": [
      "T001",
      "T002"
    ]
  },
  "detection": {
    "query": "selection1: {\"EventType\": \"SetValue\", \"TargetObject|endswith\": \"Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\SymbolicLinkValue\", \"Details|contains\": \"\\\\Software\\\\Classes\\\\{\"}\nselection2: {\"TargetObject|endswith\": \"Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\DelegateExecute\"}\nselection3: {\"EventType\": \"SetValue\", \"TargetObject|endswith\": [\"Classes\\\\ms-settings\\\\shell\\\\open\\\\command\\\\(Default)\", \"Classes\\\\exefile\\\\shell\\\\open\\\\command\\\\(Default)\"]}\nfilter_sel3: {\"Details\": \"(Empty)\"}",
    "condition": "selection1 or selection2 or (selection3 and not filter_sel3)",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "registry_event"
  ]
}