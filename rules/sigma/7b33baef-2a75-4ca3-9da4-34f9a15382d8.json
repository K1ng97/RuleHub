{
  "id": "7b33baef-2a75-4ca3-9da4-34f9a15382d8",
  "name": "Possible PrintNightmare Print Driver Install",
  "description": "Detects the remote installation of a print driver which is possible indication of the exploitation of PrintNightmare (CVE-2021-1675).\nThe occurrence of print drivers being installed remotely via RPC functions should be rare, as print drivers are normally installed locally and or through group policy.\n",
  "source": {
    "type": "sigma",
    "id": "7b33baef-2a75-4ca3-9da4-34f9a15382d8",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/zeek_dce_rpc_printnightmare_print_driver_install.yml",
    "file_path": "tmp/repos/sigma/rules/network/zeek/zeek_dce_rpc_printnightmare_print_driver_install.yml"
  },
  "tags": [
    "attackexecution",
    "cve2021-1675",
    "cve2021-1678",
    "cve2021-34527"
  ],
  "author": "@neu5ron (Nate Guagenti)",
  "references": [
    "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-par/93d1915d-4d9f-4ceb-90a7-e8f2a59adc29",
    "https://github.com/zeek/zeek/blob/691b099de13649d6576c7b9d637f8213ff818832/scripts/base/protocols/dce-rpc/consts.zeek",
    "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527",
    "https://github.com/corelight/CVE-2021-1675",
    "https://old.zeek.org/zeekweek2019/slides/bzar.pdf",
    "https://www.crowdstrike.com/blog/cve-2021-1678-printer-spooler-relay-security-advisory/"
  ],
  "severity": "medium",
  "type": "sigma",
  "status": "stable",
  "created": "2021-08-23",
  "modified": "2022-07-07",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "selection: {\"operation\": [\"RpcAsyncInstallPrinterDriverFromPackage\", \"RpcAsyncAddPrintProcessor\", \"RpcAddPrintProcessor\", \"RpcAddPrinterDriverEx\", \"RpcAddPrinterDriver\", \"RpcAsyncAddPrinterDriver\"]}",
    "condition": "selection",
    "fields": [
      "id.orig_h",
      "id.resp_h",
      "id.resp_p",
      "operation",
      "endpoint",
      "named_pipe",
      "uid"
    ]
  },
  "falsepositives": [
    "Legitimate remote alteration of a printer driver."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "zeek",
    "dce_rpc"
  ]
}