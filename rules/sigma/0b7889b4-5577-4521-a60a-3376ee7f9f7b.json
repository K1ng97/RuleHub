{
  "id": "0b7889b4-5577-4521-a60a-3376ee7f9f7b",
  "name": "WMI Persistence",
  "description": "Detects suspicious WMI event filter and command line event consumer based on WMI and Security Logs.",
  "source": {
    "type": "sigma",
    "id": "0b7889b4-5577-4521-a60a-3376ee7f9f7b",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/win_wmi_persistence.yml",
    "file_path": "tmp/repos/sigma/rules/windows/builtin/wmi/win_wmi_persistence.yml"
  },
  "tags": [
    "attackpersistence",
    "attackprivilege-escalation",
    "attackt1546003"
  ],
  "author": "Florian Roth (Nextron Systems), Gleb Sukhodolskiy, Timur Zinniatullin oscd.community",
  "references": [
    "https://twitter.com/mattifestation/status/899646620148539397",
    "https://www.eideon.com/2018-03-02-THL03-WMIBackdoors/"
  ],
  "severity": "medium",
  "type": "sigma",
  "status": "test",
  "created": "2017-08-22",
  "modified": "2022-02-10",
  "mitre": {
    "tactics": [
      "TA1546"
    ],
    "techniques": [
      "T003"
    ]
  },
  "detection": {
    "query": "wmi_filter_to_consumer_binding: {\"EventID\": 5861}\nconsumer_keywords: [\"ActiveScriptEventConsumer\", \"CommandLineEventConsumer\", \"CommandLineTemplate\"]\nwmi_filter_registration: {\"EventID\": 5859}\nfilter_scmevent: {\"Provider\": \"SCM Event Provider\", \"Query\": \"select * from MSFT_SCMEventLogEvent\", \"User\": \"S-1-5-32-544\", \"PossibleCause\": \"Permanent\"}",
    "condition": "( (wmi_filter_to_consumer_binding and consumer_keywords) or (wmi_filter_registration) ) and not filter_scmevent",
    "fields": []
  },
  "falsepositives": [
    "Unknown (data set is too small; further testing needed)"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "wmi"
  ]
}