{
  "id": "5a105d34-05fc-401e-8553-272b45c1522d",
  "name": "CobaltStrike Service Installations - System",
  "description": "Detects known malicious service installs that appear in cases in which a Cobalt Strike beacon elevates privileges or lateral movement",
  "source": {
    "type": "sigma",
    "id": "5a105d34-05fc-401e-8553-272b45c1522d",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/win_system_cobaltstrike_service_installs.yml",
    "file_path": "tmp/repos/sigma/rules/windows/builtin/system/service_control_manager/win_system_cobaltstrike_service_installs.yml"
  },
  "tags": [
    "attackexecution",
    "attacklateral-movement",
    "attackprivilege-escalation",
    "attackt1021002",
    "attackt1543003",
    "attackt1569002"
  ],
  "author": "Florian Roth (Nextron Systems), Wojciech Lesicki",
  "references": [
    "https://www.sans.org/webcasts/119395",
    "https://www.crowdstrike.com/blog/getting-the-bacon-from-cobalt-strike-beacon/",
    "https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/"
  ],
  "severity": "critical",
  "type": "sigma",
  "status": "test",
  "created": "2021-05-26",
  "modified": "2022-11-27",
  "mitre": {
    "tactics": [
      "TA1021",
      "TA1543",
      "TA1569"
    ],
    "techniques": [
      "T002",
      "T003"
    ]
  },
  "detection": {
    "query": "selection_id: {\"Provider_Name\": \"Service Control Manager\", \"EventID\": 7045}\nselection1: {\"ImagePath|contains|all\": [\"ADMIN$\", \".exe\"]}\nselection2: {\"ImagePath|contains|all\": [\"%COMSPEC%\", \"start\", \"powershell\"]}\nselection3: {\"ImagePath|contains\": \"powershell -nop -w hidden -encodedcommand\"}\nselection4: {\"ImagePath|base64offset|contains\": \"IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:\"}",
    "condition": "selection_id and (selection1 or selection2 or selection3 or selection4)",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "critical",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "system"
  ]
}