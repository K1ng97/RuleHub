{
  "id": "a7df0e9e-91a5-459a-a003-4cde67c2ff5d",
  "name": "Potentially Suspicious Command Executed Via Run Dialog Box - Registry",
  "description": "Detects execution of commands via the run dialog box on Windows by checking values of the \"RunMRU\" registry key.\nThis technique was seen being abused by threat actors to deceive users into pasting and executing malicious commands, often disguised as CAPTCHA verification steps.\n",
  "source": {
    "type": "sigma",
    "id": "a7df0e9e-91a5-459a-a003-4cde67c2ff5d",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/registry_set_runmru_susp_command_execution.yml",
    "file_path": "tmp/repos/sigma/rules/windows/registry/registry_set/registry_set_runmru_susp_command_execution.yml"
  },
  "tags": [
    "attackexecution",
    "attackt1059001"
  ],
  "author": "Ahmed Farouk, Nasreddine Bencherchali",
  "references": [
    "https://medium.com/@ahmed.moh.farou2/fake-captcha-campaign-on-arabic-pirated-movie-sites-delivers-lumma-stealer-4f203f7adabf",
    "https://medium.com/@shaherzakaria8/downloading-trojan-lumma-infostealer-through-capatcha-1f25255a0e71",
    "https://www.forensafe.com/blogs/runmrukey.html",
    "https://redcanary.com/blog/threat-intelligence/intelligence-insights-october-2024/"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2024-11-01",
  "modified": "2024-11-01",
  "mitre": {
    "tactics": [
      "TA1059"
    ],
    "techniques": [
      "T001"
    ]
  },
  "detection": {
    "query": "selection_key: {\"TargetObject|contains\": \"\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\RunMRU\"}\nselection_powershell_command: {\"Details|contains\": [\"powershell\", \"pwsh\"]}\nselection_powershell_susp_keywords: {\"Details|contains\": [\" -e \", \" -ec \", \" -en \", \" -enc \", \" -enco\", \"ftp\", \"Hidden\", \"http\", \"iex\", \"Invoke-\"]}\nselection_wmic_command: {\"Details|contains\": \"wmic\"}\nselection_wmic_susp_keywords: {\"Details|contains\": [\"shadowcopy\", \"process call create\"]}",
    "condition": "selection_key and (all of selection_powershell_* or all of selection_wmic_*)",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "registry_set"
  ]
}