{
  "id": "beaa66d6-aa1b-4e3c-80f5-e0145369bfaf",
  "name": "Potentially Suspicious EventLog Recon Activity Using Log Query Utilities",
  "description": "Detects execution of different log query utilities and commands to search and dump the content of specific event logs or look for specific event IDs.\nThis technique is used by threat actors in order to extract sensitive information from events logs such as usernames, IP addresses, hostnames, etc.\n",
  "source": {
    "type": "sigma",
    "id": "beaa66d6-aa1b-4e3c-80f5-e0145369bfaf",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_susp_eventlog_content_recon.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_susp_eventlog_content_recon.yml"
  },
  "tags": [
    "attackcredential-access",
    "attackdiscovery",
    "attackt1552"
  ],
  "author": "Nasreddine Bencherchali (Nextron Systems), X__Junior (Nextron Systems)",
  "references": [
    "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
    "https://thedfirreport.com/2023/10/30/netsupport-intrusion-results-in-domain-compromise/",
    "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-144a",
    "https://www.group-ib.com/blog/apt41-world-tour-2021/",
    "https://labs.withsecure.com/content/dam/labs/docs/f-secureLABS-tlp-white-lazarus-threat-intel-report2.pdf",
    "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.diagnostics/get-winevent?view=powershell-7.3",
    "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1",
    "http://www.solomonson.com/posts/2010-07-09-reading-eventviewer-command-line/",
    "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil"
  ],
  "severity": "medium",
  "type": "sigma",
  "status": "experimental",
  "created": "2022-09-09",
  "modified": "2024-08-15",
  "mitre": {
    "tactics": [
      "TA1552"
    ],
    "techniques": []
  },
  "detection": {
    "query": "selection_wmi: {\"CommandLine|contains|all\": [\"Select\", \"Win32_NTLogEvent\"]}\nselection_wevtutil_img: [{\"Image|endswith\": \"\\\\wevtutil.exe\"}, {\"OriginalFileName\": \"wevtutil.exe\"}]\nselection_wevtutil_cli: {\"CommandLine|contains\": [\" qe \", \" query-events \"]}\nselection_wmic_img: [{\"Image|endswith\": \"\\\\wmic.exe\"}, {\"OriginalFileName\": \"wmic.exe\"}]\nselection_wmic_cli: {\"CommandLine|contains\": \" ntevent\"}\nselection_cmdlet: {\"CommandLine|contains\": [\"Get-WinEvent \", \"get-eventlog \"]}\nselection_logs_name: {\"CommandLine|contains\": [\"Microsoft-Windows-PowerShell\", \"Microsoft-Windows-Security-Auditing\", \"Microsoft-Windows-TerminalServices-LocalSessionManager\", \"Microsoft-Windows-TerminalServices-RemoteConnectionManager\", \"Microsoft-Windows-Windows Defender\", \"PowerShellCore\", \"Security\", \"Windows PowerShell\"]}\nselection_logs_eid: {\"CommandLine|contains\": [\"-InstanceId 462?\", \".eventid -eq 462?\", \"EventCode=?462?\", \"EventIdentifier=?462?\", \"System[EventID=462?]\", \"-InstanceId 4778\", \".eventid -eq 4778\", \"System[EventID=4778]\", \"EventCode=?4778?\", \"EventIdentifier=?4778?\", \"-InstanceId 25\", \".eventid -eq 25\", \"System[EventID=25]\", \"EventCode=?25?\", \"EventIdentifier=?25?\"]}",
    "condition": "1 of selection_logs_* and (selection_wmi or all of selection_wevtutil_* or all of selection_wmic_* or selection_cmdlet)",
    "fields": []
  },
  "falsepositives": [
    "Legitimate usage of the utility by administrators to query the event log"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}