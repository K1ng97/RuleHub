{
  "id": "452bce90-6fb0-43cc-97a5-affc283139b3",
  "name": "Suspicious Windows Defender Registry Key Tampering Via Reg.EXE",
  "description": "Detects the usage of \"reg.exe\" to tamper with different Windows Defender registry keys in order to disable some important features related to protection and detection",
  "source": {
    "type": "sigma",
    "id": "452bce90-6fb0-43cc-97a5-affc283139b3",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_reg_windows_defender_tamper.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_reg_windows_defender_tamper.yml"
  },
  "tags": [
    "attackdefense-evasion",
    "attackt1562001"
  ],
  "author": "Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel, Nasreddine Bencherchali (Nextron Systems)",
  "references": [
    "https://thedfirreport.com/2022/03/21/apt35-automates-initial-access-using-proxyshell/",
    "https://github.com/swagkarna/Defeat-Defender-V1.2.0",
    "https://www.elevenforum.com/t/video-guide-how-to-completely-disable-microsoft-defender-antivirus.14608/page-2"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2022-03-22",
  "modified": "2023-06-05",
  "mitre": {
    "tactics": [
      "TA1562"
    ],
    "techniques": [
      "T001"
    ]
  },
  "detection": {
    "query": "selection_root_img: [{\"Image|endswith\": \"\\\\reg.exe\"}, {\"OriginalFileName\": \"reg.exe\"}]\nselection_root_path: {\"CommandLine|contains\": [\"SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\\", \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center\", \"SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\\"]}\nselection_dword_0: {\"CommandLine|contains|all\": [\" add \", \"d 0\"], \"CommandLine|contains\": [\"DisallowExploitProtectionOverride\", \"EnableControlledFolderAccess\", \"MpEnablePus\", \"PUAProtection\", \"SpynetReporting\", \"SubmitSamplesConsent\", \"TamperProtection\"]}\nselection_dword_1: {\"CommandLine|contains|all\": [\" add \", \"d 1\"], \"CommandLine|contains\": [\"DisableAntiSpyware\", \"DisableAntiSpywareRealtimeProtection\", \"DisableAntiVirus\", \"DisableArchiveScanning\", \"DisableBehaviorMonitoring\", \"DisableBlockAtFirstSeen\", \"DisableConfig\", \"DisableEnhancedNotifications\", \"DisableIntrusionPreventionSystem\", \"DisableIOAVProtection\", \"DisableOnAccessProtection\", \"DisablePrivacyMode\", \"DisableRealtimeMonitoring\", \"DisableRoutinelyTakingAction\", \"DisableScanOnRealtimeEnable\", \"DisableScriptScanning\", \"Notification_Suppress\", \"SignatureDisableUpdateOnStartupWithoutEngine\"]}",
    "condition": "all of selection_root_* and 1 of selection_dword_*",
    "fields": []
  },
  "falsepositives": [
    "Rare legitimate use by administrators to test software (should always be investigated)"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}