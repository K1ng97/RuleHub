{
  "id": "f742bde7-9528-42e5-bd82-84f51a8387d2",
  "name": "Uncommon Microsoft Office Trusted Location Added",
  "description": "Detects changes to registry keys related to \"Trusted Location\" of Microsoft Office where the path is set to something uncommon. Attackers might add additional trusted locations to avoid macro security restrictions.",
  "source": {
    "type": "sigma",
    "id": "f742bde7-9528-42e5-bd82-84f51a8387d2",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/registry_set_office_trusted_location_uncommon.yml",
    "file_path": "tmp/repos/sigma/rules/windows/registry/registry_set/registry_set_office_trusted_location_uncommon.yml"
  },
  "tags": [
    "attackdefense-evasion",
    "attackt1112"
  ],
  "author": "Nasreddine Bencherchali (Nextron Systems)",
  "references": [
    "Internal Research",
    "https://admx.help/?Category=Office2016&Policy=excel16.Office.Microsoft.Policies.Windows::L_TrustedLoc01"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2023-06-21",
  "modified": "2023-09-29",
  "mitre": {
    "tactics": [
      "TA1112"
    ],
    "techniques": []
  },
  "detection": {
    "query": "selection: {\"TargetObject|contains\": \"Security\\\\Trusted Locations\\\\Location\", \"TargetObject|endswith\": \"\\\\Path\"}\nfilter_exclude_known_paths: {\"Details|contains\": [\"%APPDATA%\\\\Microsoft\\\\Templates\", \"%%APPDATA%%\\\\Microsoft\\\\Templates\", \"%APPDATA%\\\\Microsoft\\\\Word\\\\Startup\", \"%%APPDATA%%\\\\Microsoft\\\\Word\\\\Startup\", \":\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\Templates\\\\\", \":\\\\Program Files\\\\Microsoft Office (x86)\\\\Templates\", \":\\\\Program Files\\\\Microsoft Office\\\\root\\\\Templates\\\\\", \":\\\\Program Files\\\\Microsoft Office\\\\Templates\\\\\"]}\nfilter_main_office_click_to_run: {\"Image|contains\": \":\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\\", \"Image|endswith\": \"\\\\OfficeClickToRun.exe\"}\nfilter_main_office_apps: {\"Image|contains\": [\":\\\\Program Files\\\\Microsoft Office\\\\\", \":\\\\Program Files (x86)\\\\Microsoft Office\\\\\"]}",
    "condition": "selection and not 1 of filter_main_* and not 1 of filter_exclude_*",
    "fields": []
  },
  "falsepositives": [
    "Other unknown legitimate or custom paths need to be filtered to avoid false positives"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "registry_set"
  ]
}