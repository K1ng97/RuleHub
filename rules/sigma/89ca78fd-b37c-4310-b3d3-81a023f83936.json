{
  "id": "89ca78fd-b37c-4310-b3d3-81a023f83936",
  "name": "Schtasks Creation Or Modification With SYSTEM Privileges",
  "description": "Detects the creation or update of a scheduled task to run with \"NT AUTHORITY\\SYSTEM\" privileges",
  "source": {
    "type": "sigma",
    "id": "89ca78fd-b37c-4310-b3d3-81a023f83936",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_schtasks_system.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_schtasks_system.yml"
  },
  "tags": [
    "attackexecution",
    "attackpersistence",
    "attackt1053005"
  ],
  "author": "Nasreddine Bencherchali (Nextron Systems)",
  "references": [
    "https://www.elastic.co/security-labs/exploring-the-qbot-attack-pattern",
    "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/schtasks"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2022-07-28",
  "modified": "2025-02-15",
  "mitre": {
    "tactics": [
      "TA1053"
    ],
    "techniques": [
      "T005"
    ]
  },
  "detection": {
    "query": "selection_root: {\"Image|endswith\": \"\\\\schtasks.exe\", \"CommandLine|contains\": [\" /change \", \" /create \"]}\nselection_run: {\"CommandLine|contains\": \"/ru \"}\nselection_user: {\"CommandLine|contains\": [\"NT AUT\", \" SYSTEM \"]}\nfilter_optional_teamviewer: {\"Image|endswith\": \"\\\\schtasks.exe\", \"CommandLine|contains|all\": [\"/TN TVInstallRestore\", \"\\\\TeamViewer_.exe\"]}\nfilter_optional_office: {\"CommandLine|contains|all\": [\"Subscription Heartbeat\", \"\\\\HeartbeatConfig.xml\", \"\\\\Microsoft Shared\\\\OFFICE\"]}\nfilter_optional_avira: {\"CommandLine|contains\": [\"/Create /F /RU System /SC WEEKLY /TN AviraSystemSpeedupVerify /TR \", \":\\\\Program Files (x86)\\\\Avira\\\\System Speedup\\\\setup\\\\avira_speedup_setup.exe\", \"/VERIFY /VERYSILENT /NOSTART /NODOTNET /NORESTART\\\" /RL HIGHEST\"]}",
    "condition": "all of selection_* and not 1 of filter_optional_*",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}