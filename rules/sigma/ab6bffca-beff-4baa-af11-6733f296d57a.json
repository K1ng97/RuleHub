{
  "id": "ab6bffca-beff-4baa-af11-6733f296d57a",
  "name": "Potential AD User Enumeration From Non-Machine Account",
  "description": "Detects read access to a domain user from a non-machine account",
  "source": {
    "type": "sigma",
    "id": "ab6bffca-beff-4baa-af11-6733f296d57a",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/win_security_ad_user_enumeration.yml",
    "file_path": "tmp/repos/sigma/rules/windows/builtin/security/win_security_ad_user_enumeration.yml"
  },
  "tags": [
    "attackdiscovery",
    "attackt1087002"
  ],
  "author": "Maxime Thiebaut (@0xThiebaut)",
  "references": [
    "https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf",
    "http://www.stuffithoughtiknew.com/2019/02/detecting-bloodhound.html",
    "https://learn.microsoft.com/en-us/windows/win32/adschema/attributes-all",
    "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4662"
  ],
  "severity": "medium",
  "type": "sigma",
  "status": "test",
  "created": "2020-03-30",
  "modified": "2022-11-08",
  "mitre": {
    "tactics": [
      "TA1087"
    ],
    "techniques": [
      "T002"
    ]
  },
  "detection": {
    "query": "selection: {\"EventID\": 4662, \"ObjectType|contains\": \"bf967aba-0de6-11d0-a285-00aa003049e2\", \"AccessMask|endswith\": [\"1?\", \"3?\", \"4?\", \"7?\", \"9?\", \"B?\", \"D?\", \"F?\"]}\nfilter_main_machine_accounts: {\"SubjectUserName|endswith\": \"$\"}\nfilter_main_msql: {\"SubjectUserName|startswith\": \"MSOL_\"}",
    "condition": "selection and not 1 of filter_main_*",
    "fields": []
  },
  "falsepositives": [
    "Administrators configuring new users."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "security"
  ]
}