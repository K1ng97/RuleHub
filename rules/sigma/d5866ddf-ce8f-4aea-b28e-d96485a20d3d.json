{
  "id": "d5866ddf-ce8f-4aea-b28e-d96485a20d3d",
  "name": "Files With System Process Name In Unsuspected Locations",
  "description": "Detects the creation of an executable with a system process name in folders other than the system ones (System32, SysWOW64, etc.).\nIt is highly recommended to perform an initial baseline before using this rule in production.\n",
  "source": {
    "type": "sigma",
    "id": "d5866ddf-ce8f-4aea-b28e-d96485a20d3d",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/file_event_win_creation_system_file.yml",
    "file_path": "tmp/repos/sigma/rules/windows/file/file_event/file_event_win_creation_system_file.yml"
  },
  "tags": [
    "attackdefense-evasion",
    "attackt1036005"
  ],
  "author": "Sander Wiebing, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)",
  "references": [
    "Internal Research"
  ],
  "severity": "medium",
  "type": "sigma",
  "status": "test",
  "created": "2020-05-26",
  "modified": "2024-06-24",
  "mitre": {
    "tactics": [
      "TA1036"
    ],
    "techniques": [
      "T005"
    ]
  },
  "detection": {
    "query": "selection: {\"TargetFilename|endswith\": [\"\\\\AtBroker.exe\", \"\\\\audiodg.exe\", \"\\\\backgroundTaskHost.exe\", \"\\\\bcdedit.exe\", \"\\\\bitsadmin.exe\", \"\\\\cmdl32.exe\", \"\\\\cmstp.exe\", \"\\\\conhost.exe\", \"\\\\csrss.exe\", \"\\\\dasHost.exe\", \"\\\\dfrgui.exe\", \"\\\\dllhost.exe\", \"\\\\dwm.exe\", \"\\\\eventcreate.exe\", \"\\\\eventvwr.exe\", \"\\\\explorer.exe\", \"\\\\extrac32.exe\", \"\\\\fontdrvhost.exe\", \"\\\\ipconfig.exe\", \"\\\\iscsicli.exe\", \"\\\\iscsicpl.exe\", \"\\\\logman.exe\", \"\\\\LogonUI.exe\", \"\\\\LsaIso.exe\", \"\\\\lsass.exe\", \"\\\\lsm.exe\", \"\\\\msiexec.exe\", \"\\\\msinfo32.exe\", \"\\\\mstsc.exe\", \"\\\\nbtstat.exe\", \"\\\\odbcconf.exe\", \"\\\\powershell.exe\", \"\\\\pwsh.exe\", \"\\\\regini.exe\", \"\\\\regsvr32.exe\", \"\\\\rundll32.exe\", \"\\\\RuntimeBroker.exe\", \"\\\\schtasks.exe\", \"\\\\SearchFilterHost.exe\", \"\\\\SearchIndexer.exe\", \"\\\\SearchProtocolHost.exe\", \"\\\\SecurityHealthService.exe\", \"\\\\SecurityHealthSystray.exe\", \"\\\\services.exe\", \"\\\\ShellAppRuntime.exe\", \"\\\\sihost.exe\", \"\\\\smartscreen.exe\", \"\\\\smss.exe\", \"\\\\spoolsv.exe\", \"\\\\svchost.exe\", \"\\\\SystemSettingsBroker.exe\", \"\\\\taskhost.exe\", \"\\\\taskhostw.exe\", \"\\\\Taskmgr.exe\", \"\\\\TiWorker.exe\", \"\\\\vssadmin.exe\", \"\\\\w32tm.exe\", \"\\\\WerFault.exe\", \"\\\\WerFaultSecure.exe\", \"\\\\wermgr.exe\", \"\\\\wevtutil.exe\", \"\\\\wininit.exe\", \"\\\\winlogon.exe\", \"\\\\winrshost.exe\", \"\\\\WinRTNetMUAHostServer.exe\", \"\\\\wlanext.exe\", \"\\\\wlrmdr.exe\", \"\\\\WmiPrvSE.exe\", \"\\\\wslhost.exe\", \"\\\\WSReset.exe\", \"\\\\WUDFHost.exe\", \"\\\\WWAHost.exe\"]}\nfilter_main_generic: {\"TargetFilename|contains\": [\"C:\\\\$WINDOWS.~BT\\\\\", \"C:\\\\$WinREAgent\\\\\", \"C:\\\\Windows\\\\SoftwareDistribution\\\\\", \"C:\\\\Windows\\\\System32\\\\\", \"C:\\\\Windows\\\\SysWOW64\\\\\", \"C:\\\\Windows\\\\WinSxS\\\\\", \"C:\\\\Windows\\\\uus\\\\\"]}\nfilter_main_svchost: {\"Image|endswith\": \"C:\\\\Windows\\\\system32\\\\svchost.exe\", \"TargetFilename|contains\": \"C:\\\\Program Files\\\\WindowsApps\\\\\"}\nfilter_main_wuauclt: {\"Image|endswith\": \"C:\\\\Windows\\\\System32\\\\wuauclt.exe\"}\nfilter_main_explorer: {\"TargetFilename|endswith\": \"C:\\\\Windows\\\\explorer.exe\"}\nfilter_main_msiexec: {\"Image|endswith\": \"C:\\\\WINDOWS\\\\system32\\\\msiexec.exe\", \"TargetFilename|endswith\": [\"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\"]}\nfilter_main_healtray: {\"TargetFilename|contains\": \"C:\\\\Windows\\\\System32\\\\SecurityHealth\\\\\", \"TargetFilename|endswith\": \"\\\\SecurityHealthSystray.exe\", \"Image|endswith\": \"\\\\SecurityHealthSetup.exe\"}",
    "condition": "selection and not 1 of filter_main_*",
    "fields": []
  },
  "falsepositives": [
    "System processes copied outside their default folders for testing purposes",
    "Third party software naming their software with the same names as the processes mentioned here"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "file_event"
  ]
}