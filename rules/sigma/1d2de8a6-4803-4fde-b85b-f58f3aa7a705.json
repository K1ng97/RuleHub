{
  "id": "1d2de8a6-4803-4fde-b85b-f58f3aa7a705",
  "name": "Potentially Suspicious WDAC Policy File Creation",
  "description": "Detects suspicious Windows Defender Application Control (WDAC) policy file creation from abnormal processes that could be abused by attacker to block EDR/AV components while allowing their own malicious code to run on the system.\n",
  "source": {
    "type": "sigma",
    "id": "1d2de8a6-4803-4fde-b85b-f58f3aa7a705",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/file_event_win_susp_wdac_policy_creation.yml",
    "file_path": "tmp/repos/sigma/rules/windows/file/file_event/file_event_win_susp_wdac_policy_creation.yml"
  },
  "tags": [
    "attackdefense-evasion"
  ],
  "author": "X__Junior",
  "references": [
    "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/deploy-appcontrol-policies-using-group-policy",
    "https://beierle.win/2024-12-20-Weaponizing-WDAC-Killing-the-Dreams-of-EDR/",
    "https://github.com/logangoins/Krueger/tree/main",
    "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/appcontrol-deployment-guide",
    "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/deploy-appcontrol-policies-with-script",
    "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/app-control-for-business/deployment/deploy-appcontrol-policies-with-memcm"
  ],
  "severity": "medium",
  "type": "sigma",
  "status": "experimental",
  "created": "2025-02-07",
  "modified": "2025-04-21",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "selection_target: {\"TargetFilename|contains\": \"\\\\Windows\\\\System32\\\\CodeIntegrity\\\\\"}\nfilter_main_images: {\"Image|endswith\": [\"\\\\Microsoft.ConfigurationManagement.exe\", \"\\\\WDAC Wizard.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\", \"C:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"C:\\\\Windows\\\\System32\\\\dllhost.exe\", \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\dllhost.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \"C:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"]}\nfilter_main_cli: [{\"CommandLine|contains|all\": [\"ConvertFrom-CIPolicy -XmlFilePath\", \"-BinaryFilePath \"]}, {\"CommandLine|contains\": \"CiTool --update-policy\"}, {\"CommandLine|contains|all\": [\"Copy-Item -Path\", \"-Destination\"]}]\nfilter_main_system: {\"Image\": \"System\"}",
    "condition": "selection_target and not 1 of filter_main_*",
    "fields": []
  },
  "falsepositives": [
    "Administrators and security vendors could leverage WDAC, apply additional filters as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "file_event"
  ]
}