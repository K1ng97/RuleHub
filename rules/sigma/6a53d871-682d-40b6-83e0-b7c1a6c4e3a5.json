{
  "id": "6a53d871-682d-40b6-83e0-b7c1a6c4e3a5",
  "name": "PetitPotam Suspicious Kerberos TGT Request",
  "description": "Detect suspicious Kerberos TGT requests.\nOnce an attacer obtains a computer certificate by abusing Active Directory Certificate Services in combination with PetitPotam, the next step would be to leverage the certificate for malicious purposes.\nOne way of doing this is to request a Kerberos Ticket Granting Ticket using a tool like Rubeus.\nThis request will generate a 4768 event with some unusual fields depending on the environment.\nThis analytic will require tuning, we recommend filtering Account_Name to the Domain Controller computer accounts.\n",
  "source": {
    "type": "sigma",
    "id": "6a53d871-682d-40b6-83e0-b7c1a6c4e3a5",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/win_security_petitpotam_susp_tgt_request.yml",
    "file_path": "tmp/repos/sigma/rules/windows/builtin/security/win_security_petitpotam_susp_tgt_request.yml"
  },
  "tags": [
    "attackcredential-access",
    "attackt1187"
  ],
  "author": "Mauricio Velazco, Michael Haag",
  "references": [
    "https://github.com/topotam/PetitPotam",
    "https://isc.sans.edu/forums/diary/Active+Directory+Certificate+Services+ADCS+PKI+domain+admin+vulnerability/27668/",
    "https://github.com/splunk/security_content/blob/develop/detections/endpoint/petitpotam_suspicious_kerberos_tgt_request.yml"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2021-09-02",
  "modified": "2022-10-05",
  "mitre": {
    "tactics": [
      "TA1187"
    ],
    "techniques": []
  },
  "detection": {
    "query": "selection: {\"EventID\": 4768, \"TargetUserName|endswith\": \"$\", \"CertThumbprint|contains\": \"*\"}\nfilter_local: {\"IpAddress\": \"::1\"}\nfilter_thumbprint: {\"CertThumbprint\": \"\"}",
    "condition": "selection and not 1 of filter_*",
    "fields": []
  },
  "falsepositives": [
    "False positives are possible if the environment is using certificates for authentication. We recommend filtering Account_Name to the Domain Controller computer accounts."
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "security"
  ]
}