{
  "id": "84972c80-251c-4c3a-9079-4f00aad93938",
  "name": "Sensitive File Recovery From Backup Via Wbadmin.EXE",
  "description": "Detects the dump of highly sensitive files such as \"NTDS.DIT\" and \"SECURITY\" hive.\nAttackers can leverage the \"wbadmin\" utility in order to dump sensitive files that might contain credential or sensitive information.\n",
  "source": {
    "type": "sigma",
    "id": "84972c80-251c-4c3a-9079-4f00aad93938",
    "url": "https://github.com/SigmaHQ/sigma/blob/master/proc_creation_win_wbadmin_restore_sensitive_files.yml",
    "file_path": "tmp/repos/sigma/rules/windows/process_creation/proc_creation_win_wbadmin_restore_sensitive_files.yml"
  },
  "tags": [
    "attackcredential-access",
    "attackt1003003"
  ],
  "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
  "references": [
    "https://github.com/LOLBAS-Project/LOLBAS/blob/2cc01b01132b5c304027a658c698ae09dd6a92bf/yml/OSBinaries/Wbadmin.yml",
    "https://lolbas-project.github.io/lolbas/Binaries/Wbadmin/",
    "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wbadmin-start-recovery",
    "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wbadmin-start-backup"
  ],
  "severity": "high",
  "type": "sigma",
  "status": "test",
  "created": "2024-05-10",
  "modified": "2024-05-10",
  "mitre": {
    "tactics": [
      "TA1003"
    ],
    "techniques": [
      "T003"
    ]
  },
  "detection": {
    "query": "selection_img: [{\"Image|endswith\": \"\\\\wbadmin.exe\"}, {\"OriginalFileName\": \"WBADMIN.EXE\"}]\nselection_backup: {\"CommandLine|contains|all\": [\" recovery\", \"recoveryTarget\", \"itemtype:File\"], \"CommandLine|contains\": [\"\\\\config\\\\SAM\", \"\\\\config\\\\SECURITY\", \"\\\\config\\\\SYSTEM\", \"\\\\Windows\\\\NTDS\\\\NTDS.dit\"]}",
    "condition": "all of selection_*",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "high",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": [
    "windows",
    "process_creation"
  ]
}