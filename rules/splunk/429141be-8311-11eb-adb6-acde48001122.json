{
  "id": "429141be-8311-11eb-adb6-acde48001122",
  "name": "Windows Service Created with Suspicious Service Path",
  "description": "The following analytic detects the creation of a Windows Service with a binary path located in uncommon directories, using Windows Event ID 7045. It leverages logs from the `wineventlog_system` to identify services installed outside typical system directories. This activity is significant as adversaries, including those deploying Clop ransomware, often create malicious services for lateral movement, remote code execution, persistence, and execution. If confirmed malicious, this could allow attackers to maintain persistence, execute arbitrary code, and potentially escalate privileges, posing a severe threat to the environment.",
  "source": {
    "type": "splunk",
    "id": "429141be-8311-11eb-adb6-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_service_created_with_suspicious_service_path.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_service_created_with_suspicious_service_path.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Mauricio Velazco, Splunk",
  "references": [
    "https://www.mandiant.com/resources/fin11-email-campaigns-precursor-for-ransomware-data-theft",
    "https://blog.virustotal.com/2020/11/keep-your-friends-close-keep-ransomware.html"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_system` EventCode=7045 ImagePath = \"*.exe\" NOT (ImagePath IN (\"*:\\\\Windows\\\\*\", \"*:\\\\Program File*\", \"*:\\\\Programdata\\\\*\", \"*%systemroot%\\\\*\")) | stats count min(_time) as firstTime max(_time) as lastTime by EventCode ImagePath ServiceName ServiceType StartType Computer UserID | rename Computer as dest| `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_service_created_with_suspicious_service_path_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the Service name, Service File Name Service Start type, and Service Type from your endpoints.",
    "fields": []
  },
  "falsepositives": [
    "Legitimate applications may install services with uncommon services paths."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}