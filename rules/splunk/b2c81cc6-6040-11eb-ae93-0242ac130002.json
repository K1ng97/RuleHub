{
  "id": "b2c81cc6-6040-11eb-ae93-0242ac130002",
  "name": "O365 Add App Role Assignment Grant User",
  "description": "The following analytic detects the addition of an application role assignment grant to a user in Office 365. It leverages data from the `o365_management_activity` dataset, specifically monitoring the \"Add app role assignment grant to user\" operation. This activity is significant as it can indicate unauthorized privilege escalation or the assignment of sensitive roles to users. If confirmed malicious, this could allow an attacker to gain elevated permissions, potentially leading to unauthorized access to critical resources and data within the Office 365 environment.",
  "source": {
    "type": "splunk",
    "id": "b2c81cc6-6040-11eb-ae93-0242ac130002",
    "url": "https://github.com/splunk/security_content/blob/develop/o365_add_app_role_assignment_grant_user.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/o365_add_app_role_assignment_grant_user.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Rod Soto, Splunk",
  "references": [
    "https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/wp-m-unc2452-2021-000343-01.pdf",
    "https://www.cisa.gov/uscert/ncas/alerts/aa21-008a"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`o365_management_activity` Workload=AzureActiveDirectory Operation=\"Add app role assignment grant to user.\" | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by signature dest user src vendor_account vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `o365_add_app_role_assignment_grant_user_filter`",
    "condition": "You must install splunk Microsoft Office 365 add-on. This search works with o365:management:activity",
    "fields": []
  },
  "falsepositives": [
    "The creation of a new Federation is not necessarily malicious, however this events need to be followed closely, as it may indicate federated credential abuse or backdoor via federated identities at a different cloud provider."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}