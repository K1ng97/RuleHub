{
  "id": "8351340b-ac0e-41ec-8b07-dd01bf32d6ea",
  "name": "Windows Hijack Execution Flow Version Dll Side Load",
  "description": "The following analytic detects a process loading a version.dll file from a directory other than %windir%\\system32 or %windir%\\syswow64. This detection leverages Sysmon EventCode 7 to identify instances where an unsigned or improperly located version.dll is loaded. This activity is significant as it is a common technique used in ransomware and APT malware campaigns, including Brute Ratel C4, to execute malicious code via DLL side loading. If confirmed malicious, this could allow attackers to execute arbitrary code, maintain persistence, and potentially compromise the target host.",
  "source": {
    "type": "splunk",
    "id": "8351340b-ac0e-41ec-8b07-dd01bf32d6ea",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_hijack_execution_flow_version_dll_side_load.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_hijack_execution_flow_version_dll_side_load.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://www.mdsec.co.uk/2022/08/part-3-how-i-met-your-beacon-brute-ratel/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-06",
  "modified": "2025-05-06",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventCode=7 ImageLoaded = \"*\\\\version.dll\" AND (Signed = \"false\" OR NOT(ImageLoaded IN(\"*\\\\windows\\\\system32*\",  \"*\\\\windows\\\\syswow64\\\\*\"))) | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by Image ImageLoaded dest loaded_file loaded_file_path original_file_name process_exec process_guid process_hash process_id process_name process_path service_dll_signature_exists service_dll_signature_verified signature signature_id user_id vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_hijack_execution_flow_version_dll_side_load_filter`",
    "condition": "The latest Sysmon TA 3.0 https://splunkbase.splunk.com/app/5709 will add the ImageLoaded name to the process_name field, allowing this query to work. Use as an example and implement for other products.",
    "fields": []
  },
  "falsepositives": [
    "unknown"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}