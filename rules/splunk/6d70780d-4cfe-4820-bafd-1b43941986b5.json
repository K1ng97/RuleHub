{
  "id": "6d70780d-4cfe-4820-bafd-1b43941986b5",
  "name": "Windows Powershell Logoff User via Quser",
  "description": "The following analytic detects the process of logging off a user through the use of the quser and logoff commands. By monitoring for these commands, the analytic identifies actions where a user session is forcibly terminated, which could be part of an administrative task or a potentially unauthorized access attempt. This detection helps identify potential misuse or malicious activity where a userâ€™s access is revoked without proper authorization, providing insight into potential security incidents involving account management or session manipulation.",
  "source": {
    "type": "splunk",
    "id": "6d70780d-4cfe-4820-bafd-1b43941986b5",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_powershell_logoff_user_via_quser.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_powershell_logoff_user_via_quser.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://devblogs.microsoft.com/scripting/automating-quser-through-powershell/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`powershell` EventCode=4104 ScriptBlockText = \"*quser*logoff*\" | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest signature signature_id user_id vendor_product EventID Guid Opcode Name Path ProcessID ScriptBlockId ScriptBlockText | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_powershell_logoff_user_via_quser_filter`",
    "condition": "The following Hunting analytic requires PowerShell operational logs to be imported. Modify the powershell macro as needed to match the sourcetype or add index. This analytic is specific to 4104, or PowerShell Script Block Logging.",
    "fields": []
  },
  "falsepositives": [
    "Administrators or power users may use this command."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}