{
  "id": "6fa31414-546e-11ec-adfa-acde48001122",
  "name": "Short Lived Scheduled Task",
  "description": "The following analytic detects the creation and deletion of scheduled tasks within a short time frame (less than 30 seconds) using Windows Security EventCodes 4698 and 4699. This behavior is identified by analyzing Windows Security Event Logs and leveraging the Windows TA for parsing. Such activity is significant as it may indicate lateral movement or remote code execution attempts by adversaries. If confirmed malicious, this could lead to unauthorized access, data exfiltration, or execution of malicious payloads, necessitating prompt investigation and response by security analysts.",
  "source": {
    "type": "splunk",
    "id": "6fa31414-546e-11ec-adfa-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/short_lived_scheduled_task.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/short_lived_scheduled_task.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1053/005/",
    "https://docs.microsoft.com/en-us/windows/win32/taskschd/about-the-task-scheduler"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=4698 OR EventCode=4699 | xmlkv Message | transaction Task_Name  startswith=(EventCode=4698) endswith=(EventCode=4699) | eval short_lived=case((duration<30),\"TRUE\") | search  short_lived = TRUE | rename ComputerName as dest| table _time, dest, Account_Name, Command, Task_Name, short_lived | `short_lived_scheduled_task_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Windows Security Event Logs with 4698 EventCode enabled. The Windows TA is also required.",
    "fields": []
  },
  "falsepositives": [
    "Although uncommon, legitimate applications may create and delete a Scheduled Task within 30 seconds. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}