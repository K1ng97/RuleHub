{
  "id": "d1ab841c-36a6-46cf-b50f-b2b04b31182a",
  "name": "Windows AD DSRM Password Reset",
  "description": "The following analytic detects attempts to reset the Directory Services Restore Mode (DSRM) administrator password on a Domain Controller. It leverages event code 4794 from the Windows Security Event Log, specifically looking for events where the DSRM password reset is attempted. This activity is significant because the DSRM account can be used similarly to a local administrator account, providing potential persistence for an attacker. If confirmed malicious, this could allow an attacker to maintain administrative access to the Domain Controller, posing a severe risk to the domain's security.",
  "source": {
    "type": "splunk",
    "id": "d1ab841c-36a6-46cf-b50f-b2b04b31182a",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_ad_dsrm_password_reset.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_ad_dsrm_password_reset.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Dean Luxton",
  "references": [
    "https://adsecurity.org/?p=1714"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats `security_content_summariesonly` min(_time) as _time from datamodel=Change where All_Changes.result_id=\"4794\" AND All_Changes.result=\"set the Directory Services Restore Mode administrator password\" by All_Changes.action, All_Changes.dest, All_Changes.src, All_Changes.user | `drop_dm_object_name(All_Changes)` | `windows_ad_dsrm_password_reset_filter`",
    "condition": "To successfully implement this search, you need to be ingesting eventcode `4794` and  have the Advanced Security Audit policy `Audit User Account Management` within `Account Management` enabled.",
    "fields": []
  },
  "falsepositives": [
    "Resetting the DSRM password for legitamate reasons, i.e. forgot the password. Disaster recovery. Deploying AD backdoor deliberately."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}