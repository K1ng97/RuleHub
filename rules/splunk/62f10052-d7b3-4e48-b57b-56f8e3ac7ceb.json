{
  "id": "62f10052-d7b3-4e48-b57b-56f8e3ac7ceb",
  "name": "Azure AD Successful PowerShell Authentication",
  "description": "The following analytic identifies a successful authentication event against an Azure AD tenant using PowerShell cmdlets. This detection leverages Azure AD SignInLogs to identify successful logins where the appDisplayName is \"Microsoft Azure PowerShell.\" This activity is significant because it is uncommon for regular, non-administrative users to authenticate using PowerShell, and it may indicate enumeration and discovery techniques by an attacker. If confirmed malicious, this activity could allow attackers to perform extensive reconnaissance, potentially leading to privilege escalation or further exploitation within the Azure environment.",
  "source": {
    "type": "splunk",
    "id": "62f10052-d7b3-4e48-b57b-56f8e3ac7ceb",
    "url": "https://github.com/splunk/security_content/blob/develop/azure_ad_successful_powershell_authentication.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/azure_ad_successful_powershell_authentication.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Gowthamaraj Rajendran, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1078/004/",
    "https://docs.microsoft.com/en-us/powershell/module/azuread/connect-azuread?view=azureadps-2.0",
    "https://securitycafe.ro/2022/04/29/pentesting-azure-recon-techniques/",
    "https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Cloud%20-%20Azure%20Pentest.md"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`azure_monitor_aad` category=SignInLogs properties.authenticationDetails{}.succeeded=true properties.appDisplayName=\"Microsoft Azure PowerShell\" | rename properties.* as * | rename userAgent as user_agent | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest user src vendor_account vendor_product user_agent signature | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `azure_ad_successful_powershell_authentication_filter`",
    "condition": "You must install the latest version of Splunk Add-on for Microsoft Cloud Services from Splunkbase (https://splunkbase.splunk.com/app/3110/#/details). You must be ingesting Azure Active Directory events into your Splunk environment through an EventHub. This analytic was written to be used with the azure:monitor:aad sourcetype leveraging the Signin log category.",
    "fields": []
  },
  "falsepositives": [
    "Administrative users will likely use PowerShell commandlets to troubleshoot and maintain the environment. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}