{
  "id": "0dc25c24-6fcf-456f-b08b-dd55a183e4de",
  "name": "Windows Service Stop Win Updates",
  "description": "The following analytic detects the disabling of Windows Update services, such as \"Update Orchestrator Service for Windows Update,\" \"WaaSMedicSvc,\" and \"Windows Update.\" It leverages Windows System Event ID 7040 logs to identify changes in service start modes to 'disabled.' This activity is significant as it can indicate an adversary's attempt to evade defenses by preventing critical updates, leaving the system vulnerable to exploits. If confirmed malicious, this could allow attackers to maintain persistence and exploit unpatched vulnerabilities, compromising the integrity and security of the affected host.",
  "source": {
    "type": "splunk",
    "id": "0dc25c24-6fcf-456f-b08b-dd55a183e4de",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_service_stop_win_updates.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_service_stop_win_updates.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://malpedia.caad.fkie.fraunhofer.de/details/win.redline_stealer"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_system` EventCode=7040 (service_name IN (\"Update Orchestrator Service for Windows Update\", \"WaaSMedicSvc\", \"Windows Update\") OR param1 IN (\"UsoSvc\", \"WaaSMedicSvc\", \"wuauserv\")) AND (param3=disabled OR start_mode = disabled) | stats count min(_time) as firstTime max(_time) as lastTime by Computer Error_Code service_name start_mode param1 param2 param3 param4 | rename Computer as dest | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_service_stop_win_updates_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the Service name, Service File Name Service Start type, and Service Type from your endpoints (like Windows system.log Event ID 7040)",
    "fields": []
  },
  "falsepositives": [
    "Network administrator may disable this services as part of its audit process within the network. Filter is needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}