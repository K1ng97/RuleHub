{
  "id": "efbcf8ee-bc75-47f1-8985-a5c638c4faf0",
  "name": "Windows MSHTA Writing to World Writable Path",
  "description": "The following analytic identifies instances of `mshta.exe` writing files to world-writable directories. It leverages Sysmon EventCode 11 logs to detect file write operations by `mshta.exe` to directories like `C:\\Windows\\Tasks` and `C:\\Windows\\Temp`. This activity is significant as it often indicates an attempt to establish persistence or execute malicious code, deviating from the utility's legitimate use. If confirmed malicious, this behavior could lead to the execution of multi-stage payloads, potentially resulting in full system compromise and unauthorized access to sensitive information.",
  "source": {
    "type": "splunk",
    "id": "efbcf8ee-bc75-47f1-8985-a5c638c4faf0",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_mshta_writing_to_world_writable_path.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_mshta_writing_to_world_writable_path.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "group",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://www.mandiant.com/resources/blog/apt29-wineloader-german-political-parties",
    "https://www.zscaler.com/blogs/security-research/european-diplomats-targeted-spikedwine-wineloader"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-06",
  "modified": "2025-05-06",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventCode=11 Image=\"*\\\\mshta.exe\" TargetFilename IN (\"*\\\\Windows\\\\Tasks\\\\*\", \"*\\\\Windows\\\\Temp\\\\*\", \"*\\\\Windows\\\\tracing\\\\*\", \"*\\\\Windows\\\\PLA\\\\Reports\\\\*\", \"*\\\\Windows\\\\PLA\\\\Rules\\\\*\", \"*\\\\Windows\\\\PLA\\\\Templates\\\\*\", \"*\\\\Windows\\\\PLA\\\\Reports\\\\en-US\\\\*\", \"*\\\\Windows\\\\PLA\\\\Rules\\\\en-US\\\\*\", \"*\\\\Windows\\\\Registration\\\\CRMLog\\\\*\", \"*\\\\Windows\\\\System32\\\\Tasks\\\\*\", \"*\\\\Windows\\\\System32\\\\Com\\\\dmp\\\\*\", \"*\\\\Windows\\\\System32\\\\LogFiles\\\\WMI\\\\*\", \"*\\\\Windows\\\\System32\\\\Microsoft\\\\Crypto\\\\RSA\\\\MachineKeys\\\\*\", \"*\\\\Windows\\\\System32\\\\spool\\\\PRINTERS\\\\*\", \"*\\\\Windows\\\\System32\\\\spool\\\\SERVERS\\\\*\", \"*\\\\Windows\\\\System32\\\\spool\\\\drivers\\\\color\\\\*\", \"*\\\\Windows\\\\System32\\\\Tasks\\\\Microsoft\\\\Windows\\\\RemoteApp and Desktop Connections Update\\\\*\", \"*\\\\Windows\\\\SysWOW64\\\\Tasks\\\\*\", \"*\\\\Windows\\\\SysWOW64\\\\Com\\\\dmp\\\\*\", \"*\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\PLA\\\\*\", \"*\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\RemoteApp and Desktop Connections Update\\\\*\", \"*\\\\Windows\\\\SysWOW64\\\\Tasks\\\\Microsoft\\\\Windows\\\\PLA\\\\System\\\\*\") | stats count min(_time) as firstTime max(_time) as lastTime by action dest file_name file_path  process_guid process_id user user_id vendor_product Image TargetFilename | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_mshta_writing_to_world_writable_path_filter`",
    "condition": "The analytic is designed to be run against Sysmon event logs collected from endpoints. The analytic requires the Sysmon event logs to be ingested into Splunk. The search focuses on EventCode 11 where the Image is `mshta.exe` and the TargetFilename is within world-writable directories such as `C:\\Windows\\Tasks`, `C:\\Windows\\Temp`, and others. The detection is designed to catch the initial file write operation by `mshta.exe` to these locations, which is indicative of an attempt to establish persistence or execute malicious code. The analytic can be modified to include additional world-writable directories as needed.",
    "fields": []
  },
  "falsepositives": [
    "False positives may occur if legitimate processes are writing to world-writable directories. It is recommended to investigate the context of the file write operation to determine if it is malicious or not. Modify the search to include additional known good paths for `mshta.exe` to reduce false positives."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}