{
  "id": "8630aa22-042b-11ec-af39-acde48001122",
  "name": "Gsuite Email With Known Abuse Web Service Link",
  "description": "The following analytic detects emails in Gsuite containing links to known abuse web services such as Pastebin, Telegram, and Discord. It leverages Gsuite Gmail logs to identify emails with these specific domains in their links. This activity is significant because these services are commonly used by attackers to deliver malicious payloads. If confirmed malicious, this could lead to the delivery of malware, phishing attacks, or other harmful activities, potentially compromising sensitive information or systems within the organization.",
  "source": {
    "type": "splunk",
    "id": "8630aa22-042b-11ec-af39-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/gsuite_email_with_known_abuse_web_service_link.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/gsuite_email_with_known_abuse_web_service_link.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://news.sophos.com/en-us/2021/07/22/malware-increasingly-targets-discord-for-abuse/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`gsuite_gmail` \"link_domain{}\" IN (\"*pastebin.com*\", \"*discord*\", \"*telegram*\",\"t.me\") | rex field=source.from_header_address \"[^@]+@(?<source_domain>[^@]+)\" | rex field=destination{}.address \"[^@]+@(?<dest_domain>[^@]+)\" | where not source_domain=\"internal_test_email.com\" and dest_domain=\"internal_test_email.com\" | eval phase=\"plan\" | eval severity=\"low\" |stats values(link_domain{}) as link_domains min(_time) as firstTime max(_time) as lastTime count by is_spam source.address source.from_header_address subject destination{}.address phase severity | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `gsuite_email_with_known_abuse_web_service_link_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs related to gsuite having the file attachment metadata like file type, file extension, source email, destination email, num of attachment and etc.",
    "fields": []
  },
  "falsepositives": [
    "normal email contains this link that are known application within the organization or network can be catched by this detection."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}