{
  "id": "2a9b80d3-6340-4345-b5ad-290bf3d222c4",
  "name": "AWS EC2 Snapshot Shared Externally",
  "description": "The following analytic detects when an EC2 snapshot is shared with an external AWS account by analyzing AWS CloudTrail events. This detection method leverages CloudTrail logs to identify modifications in snapshot permissions, specifically when the snapshot is shared outside the originating AWS account. This activity is significant as it may indicate an attempt to exfiltrate sensitive data stored in the snapshot. If confirmed malicious, an attacker could gain unauthorized access to the snapshot's data, potentially leading to data breaches or further exploitation of the compromised information.",
  "source": {
    "type": "splunk",
    "id": "2a9b80d3-6340-4345-b5ad-290bf3d222c4",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_ec2_snapshot_shared_externally.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_ec2_snapshot_shared_externally.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Bhavin Patel, Splunk",
  "references": [
    "https://labs.nettitude.com/blog/how-to-exfiltrate-aws-ec2-data/",
    "https://stratus-red-team.cloud/attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/",
    "https://hackingthe.cloud/aws/enumeration/loot_public_ebs_snapshots/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName=ModifySnapshotAttribute | rename requestParameters.createVolumePermission.add.items{}.userId as requested_account_id | search requested_account_id != NULL | eval match=if(requested_account_id==aws_account_id,\"Match\",\"No Match\") | where match = \"No Match\" | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime by signature dest user user_agent src vendor_account vendor_region vendor_product requested_account_id | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `aws_ec2_snapshot_shared_externally_filter`",
    "condition": "You must install splunk AWS add on and Splunk App for AWS. This search works with AWS CloudTrail logs.",
    "fields": []
  },
  "falsepositives": [
    "It is possible that an AWS admin has legitimately shared a snapshot with others for  a specific purpose."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}