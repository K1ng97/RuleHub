{
  "id": "3cc93f52-5aa6-4b7f-83b9-3430b1436813",
  "name": "Cisco Secure Firewall - Malware File Downloaded",
  "description": "The following analytic detects file downloads that were classified as malware by Cisco Secure Firewall Threat Defense. It relies on the `SHA_Disposition` field with a value of \"Malware\" and includes metadata such as file name, file_hash hash, and threat classification. This analytic is critical for surfacing file-based threats that are identified via Cisco's AMP or Threat Grid integrations. If confirmed malicious, this could indicate delivery of malware.\n",
  "source": {
    "type": "splunk",
    "id": "3cc93f52-5aa6-4b7f-83b9-3430b1436813",
    "url": "https://github.com/splunk/security_content/blob/develop/cisco_secure_firewall___malware_file_downloaded.yml",
    "file_path": "tmp/repos/splunk/detections/network/cisco_secure_firewall___malware_file_downloaded.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Nasreddine Bencherchali, Splunk",
  "references": [
    "https://www.cisco.com/c/en/us/td/docs/security/firepower/741/api/FQE/secure_firewall_estreamer_fqe_guide_740.pdf"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cisco_secure_firewall` EventType=FileEvent SHA_Disposition=\"Malware\" FileDirection=\"Download\"\n| lookup cisco_secure_firewall_filetype_lookup Name as FileType OUTPUT Description\n| stats count min(_time) as firstTime max(_time) as lastTime\n        values(uri) as uri\n        values(ClientApplication) as ClientApplication\n        values(file_hash) as file_hash\n        by FileDirection dest src_ip dest_port FileType app file_name ThreatName Description\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)`\n| table firstTime lastTime src_ip dest dest_port FileDirection FileType Description uri file_name file_hash app ClientApplication ThreatName SHA_Disposition\n| `cisco_secure_firewall___malware_file_downloaded_filter`\n",
    "condition": "This search requires Cisco Secure Firewall Threat Defense Logs, which\nincludes the FileEvent EventType. This search uses an input macro named `cisco_secure_firewall`.\nWe strongly recommend that you specify your environment-specific configurations\n(index, source, sourcetype, etc.) for Cisco Secure Firewall Threat Defense logs. Replace the macro definition\nwith configurations for your Splunk environment. The search also uses a post-filter\nmacro designed to filter out known false positives.\nThe logs are to be ingested using the Splunk Add-on for Cisco Security Cloud (https://splunkbase.splunk.com/app/7404).\nThe malware & file access policy must also enable logging.\n",
    "fields": []
  },
  "falsepositives": [
    "Malicious verdicts could be outdated or incorrect due to retroactive threat intel."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}