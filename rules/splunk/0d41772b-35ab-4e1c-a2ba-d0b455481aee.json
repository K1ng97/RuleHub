{
  "id": "0d41772b-35ab-4e1c-a2ba-d0b455481aee",
  "name": "Windows AD GPO Deleted",
  "description": "This detection identifies when an Active Directory Group Policy is deleted using the Group Policy Management Console.",
  "source": {
    "type": "splunk",
    "id": "0d41772b-35ab-4e1c-a2ba-d0b455481aee",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_ad_gpo_deleted.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_ad_gpo_deleted.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Dean Luxton",
  "references": [
    "https://lantern.splunk.com/Security/Product_Tips/Enterprise_Security/Enabling_an_audit_trail_from_Active_Directory"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=5136 AttributeLDAPDisplayName=gpLink | eval  ObjectDN=upper(ObjectDN) | stats min(_time) as eventTime values(eval(if(OperationType==\"%%14675\",AttributeValue,null))) as old_value values(eval(if(OperationType==\"%%14674\",AttributeValue,null))) as new_value values(OperationType) as OperationType values(src_user) as src_user values(dest) as dest by OpCorrelationID ObjectDN SubjectLogonId | rex field=old_value max_match=10000 \"(?i)LDAP://(?P<old_dn>cn.*?);(?P<old_flag>\\d)\\]\" | rex field=new_value max_match=10000 \"(?i)LDAP://(?P<new_dn>cn.*?);(?P<new_flag>\\d)\\]\" | mvexpand old_dn | where NOT old_dn IN (new_dn) | eval ObjectDN=upper(old_dn) | join ObjectDN type=outer [| search `admon` objectCategory=\"CN=Group-Policy-Container*\" admonEventType=Update | eval ObjectDN=upper(distinguishedName) | stats latest(displayName) as displayName by ObjectDN ] | stats min(eventTime) as _time values(OpCorrelationID) as OpCorrelationID values(displayName) as policyName values(src_user) as src_user by ObjectDN SubjectLogonId | `windows_ad_gpo_deleted_filter`",
    "condition": "Ensure you are ingesting Active Directory audit logs - specifically event 5136, admon data is also used to display the display name of the GPO. See lantern article in references for further on how to onboard AD audit data. Ensure the wineventlog_security and admon macros are configured with the correct indexes.",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}