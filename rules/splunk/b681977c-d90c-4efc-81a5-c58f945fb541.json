{
  "id": "b681977c-d90c-4efc-81a5-c58f945fb541",
  "name": "Windows AD Short Lived Domain Account ServicePrincipalName",
  "description": "The following analytic identifies the addition and quick deletion of a Service Principal Name (SPN) to a domain account within 5 minutes. This detection leverages EventCode 5136 from the Windows Security Event Log, focusing on changes to the servicePrincipalName attribute. This activity is significant as it may indicate an attempt to perform Kerberoasting, a technique used to crack the cleartext password of a domain account offline. If confirmed malicious, this could allow an attacker to gain unauthorized access to sensitive information or escalate privileges within the domain environment.",
  "source": {
    "type": "splunk",
    "id": "b681977c-d90c-4efc-81a5-c58f945fb541",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_ad_short_lived_domain_account_serviceprincipalname.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_ad_short_lived_domain_account_serviceprincipalname.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://adsecurity.org/?p=3466",
    "https://www.thehacker.recipes/ad/movement/dacl/targeted-kerberoasting",
    "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5136",
    "https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=5136 AttributeLDAPDisplayName=servicePrincipalName | transaction ObjectDN AttributeValue startswith=(EventCode=5136 OperationType=\"%%14674\") endswith=(EventCode=5136 OperationType=\"%%14675\") | eval short_lived=case((duration<300),\"TRUE\") | search short_lived = TRUE | rename ObjectDN as user | rename Computer as dest | `windows_ad_short_lived_domain_account_serviceprincipalname_filter`",
    "condition": "To successfully implement this search, you ned to be ingesting eventcode `5136`. The Advanced Security Audit policy setting `Audit Directory Services Changes` within `DS Access` needs to be enabled. Additionally, a SACL needs to be created for AD objects in order to ingest attribute modifications.",
    "fields": []
  },
  "falsepositives": [
    "A Service Principal Name should only be added to an account when an application requires it. Adding an SPN and quickly deleting it is less common but may be part of legitimate action. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}