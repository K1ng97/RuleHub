{
  "id": "f2132d74-cf81-4c5e-8799-ab069e67dc9f",
  "name": "AWS AMI Attribute Modification for Exfiltration",
  "description": "The following analytic detects suspicious modifications to AWS AMI attributes, such as sharing an AMI with another AWS account or making it publicly accessible. It leverages AWS CloudTrail logs to identify these changes by monitoring specific API calls. This activity is significant because adversaries can exploit these modifications to exfiltrate sensitive data stored in AWS resources. If confirmed malicious, this could lead to unauthorized access and potential data breaches, compromising the confidentiality and integrity of organizational information.",
  "source": {
    "type": "splunk",
    "id": "f2132d74-cf81-4c5e-8799-ab069e67dc9f",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_ami_attribute_modification_for_exfiltration.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_ami_attribute_modification_for_exfiltration.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Bhavin Patel, Splunk",
  "references": [
    "https://labs.nettitude.com/blog/how-to-exfiltrate-aws-ec2-data/",
    "https://stratus-red-team.cloud/attack-techniques/AWS/aws.exfiltration.ec2-share-ami/",
    "https://hackingthe.cloud/aws/enumeration/loot_public_ebs_snapshots/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName=ModifyImageAttribute (requestParameters.launchPermission.add.items{}.userId = * OR requestParameters.launchPermission.add.items{}.group = all) | rename requestParameters.launchPermission.add.items{}.group as group_added | rename requestParameters.launchPermission.add.items{}.userId as accounts_added | eval ami_status=if(match(group_added,\"all\") ,\"Public AMI\", \"Not Public\") | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime values(group_added) as group_added values(accounts_added) as accounts_added values(ami_status) as ami_status by signature dest user user_agent src vendor_account vendor_region vendor_product |  `security_content_ctime(firstTime)` |`security_content_ctime(lastTime)` | `aws_ami_attribute_modification_for_exfiltration_filter`",
    "condition": "You must install splunk AWS add on and Splunk App for AWS. This search works with AWS CloudTrail logs.",
    "fields": []
  },
  "falsepositives": [
    "It is possible that an AWS admin has legitimately shared a snapshot with others for  a specific purpose."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}