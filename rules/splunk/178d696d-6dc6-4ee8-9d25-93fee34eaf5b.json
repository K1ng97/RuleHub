{
  "id": "178d696d-6dc6-4ee8-9d25-93fee34eaf5b",
  "name": "Azure Automation Runbook Created",
  "description": "The following analytic detects the creation of a new Azure Automation Runbook within an Azure tenant. It leverages Azure Audit events, specifically the Azure Activity log category, to identify when a new Runbook is created or updated. This activity is significant because adversaries with privileged access can use Runbooks to maintain persistence, escalate privileges, or execute malicious code. If confirmed malicious, this could lead to unauthorized actions such as creating Global Administrators, executing code on VMs, and compromising the entire Azure environment.",
  "source": {
    "type": "splunk",
    "id": "178d696d-6dc6-4ee8-9d25-93fee34eaf5b",
    "url": "https://github.com/splunk/security_content/blob/develop/azure_automation_runbook_created.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/azure_automation_runbook_created.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://docs.microsoft.com/en-us/azure/automation/overview",
    "https://docs.microsoft.com/en-us/azure/automation/automation-runbook-types",
    "https://docs.microsoft.com/en-us/azure/automation/manage-runbooks",
    "https://www.inversecos.com/2021/12/how-to-detect-malicious-azure.html",
    "https://www.netspi.com/blog/technical/cloud-penetration-testing/maintaining-azure-persistence-via-automation-accounts/",
    "https://microsoft.github.io/Azure-Threat-Research-Matrix/Persistence/AZT503/AZT503-3/",
    "https://attack.mitre.org/techniques/T1136/003/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`azure_audit` operationName.localizedValue=\"Create or Update an Azure Automation Runbook\" object!=AzureAutomationTutorial* status.value=Succeeded | dedup object | rename claims.ipaddr as src, subscriptionId as vendor_account, operationName.localizedValue as operationName | stats count min(_time) as firstTime max(_time) as lastTime by dest user src vendor_account vendor_product object object_path | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `azure_automation_runbook_created_filter`",
    "condition": "You must install the latest version of Splunk Add-on for Microsoft Cloud Services from Splunkbase (https://splunkbase.splunk.com/app/3110/#/details). You must be ingesting Azure Audit events into your Splunk environment. Specifically, this analytic leverages the Azure Activity log category.",
    "fields": []
  },
  "falsepositives": [
    "Administrators may legitimately create Azure Automation Runbooks. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}