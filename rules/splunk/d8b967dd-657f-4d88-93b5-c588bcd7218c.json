{
  "id": "d8b967dd-657f-4d88-93b5-c588bcd7218c",
  "name": "Okta Risk Threshold Exceeded",
  "description": "The following correlation identifies when a user exceeds a risk threshold based on multiple suspicious Okta activities. It leverages the Risk Framework from Enterprise Security, aggregating risk events from \"Suspicious Okta Activity,\" \"Okta Account Takeover,\" and \"Okta MFA Exhaustion\" analytic stories. This detection is significant as it highlights potentially compromised user accounts exhibiting multiple tactics, techniques, and procedures (TTPs) within a 24-hour period. If confirmed malicious, this activity could indicate a serious security breach, allowing attackers to gain unauthorized access, escalate privileges, or persist within the environment.",
  "source": {
    "type": "splunk",
    "id": "d8b967dd-657f-4d88-93b5-c588bcd7218c",
    "url": "https://github.com/splunk/security_content/blob/develop/okta_risk_threshold_exceeded.yml",
    "file_path": "tmp/repos/splunk/detections/application/okta_risk_threshold_exceeded.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Bhavin Patel, Splunk",
  "references": [
    "https://developer.okta.com/docs/reference/api/event-types",
    "https://sec.okta.com/everythingisyes"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats `security_content_summariesonly` values(All_Risk.analyticstories) as analyticstories  sum(All_Risk.calculated_risk_score) as risk_score, count(All_Risk.calculated_risk_score) as risk_event_count,values(All_Risk.annotations.mitre_attack.mitre_tactic_id) as annotations.mitre_attack.mitre_tactic_id, dc(All_Risk.annotations.mitre_attack.mitre_tactic_id) as mitre_tactic_id_count, values(All_Risk.annotations.mitre_attack.mitre_technique_id) as annotations.mitre_attack.mitre_technique_id, dc(All_Risk.annotations.mitre_attack.mitre_technique_id) as mitre_technique_id_count, values(All_Risk.tag) as tag, values(source) as source, dc(source) as source_count from datamodel=Risk.All_Risk  where All_Risk.risk_object_type = user All_Risk.analyticstories IN (\"Okta Account Takeover\", \"Suspicious Okta Activity\",\"Okta MFA Exhaustion\") by All_Risk.risk_object,All_Risk.risk_object_type | `drop_dm_object_name(\"All_Risk\")` |  search mitre_technique_id_count > 5 | `okta_risk_threshold_exceeded_filter`",
    "condition": "This search leverages the Risk Framework from Enterprise Security. Ensure that \"Suspicious Okta Activity\", \"Okta Account Takeover\", and \"Okta MFA Exhaustion\" analytic stories are enabled. TTPs may be set to finding for point detections; anomalies should not be findings but rather intermediate findings. The correlation relies on intermediate findings before generating a findings. Modify the value as needed.",
    "fields": []
  },
  "falsepositives": [
    "False positives will be limited to the number of events generated by the analytics tied to the stories. Analytics will need to be tested and tuned, and the risk score reduced as needed based on the organization."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}