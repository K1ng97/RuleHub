{
  "id": "f63c34fe-a435-11eb-935a-acde48001122",
  "name": "Executable File Written in Administrative SMB Share",
  "description": "The following analytic detects executable files (.exe or .dll) being written to Windows administrative SMB shares (Admin$, IPC$, C$). It leverages Windows Security Event Logs with EventCode 5145 to identify this activity. This behavior is significant as it is commonly used by tools like PsExec/PaExec for staging binaries before creating and starting services on remote endpoints, a technique often employed for lateral movement and remote code execution. If confirmed malicious, this activity could allow an attacker to execute arbitrary code remotely, potentially compromising additional systems within the network.",
  "source": {
    "type": "splunk",
    "id": "f63c34fe-a435-11eb-935a-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/executable_file_written_in_administrative_smb_share.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/executable_file_written_in_administrative_smb_share.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Mauricio Velazco, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1021/002/",
    "https://www.rapid7.com/blog/post/2013/03/09/psexec-demystified/",
    "https://labs.vipre.com/trickbot-and-its-modules/",
    "https://whitehat.eu/incident-response-case-study-featuring-ryuk-and-trickbot-part-2/",
    "https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=5145 RelativeTargetName IN (\"*.exe\",\"*.dll\") ObjectType=File ShareName IN (\"\\\\\\\\*\\\\C$\",\"\\\\\\\\*\\\\IPC$\",\"\\\\\\\\*\\\\admin$\") AccessMask= \"0x2\" | stats min(_time) as firstTime max(_time) as lastTime count by EventCode ShareName RelativeTargetName ObjectType AccessMask src_user src_port IpAddress dest | `security_content_ctime(firstTime)`  | `executable_file_written_in_administrative_smb_share_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Windows Security Event Logs with 5145 EventCode enabled. The Windows TA is also required. Also enable the object Audit access success/failure in your group policy.",
    "fields": []
  },
  "falsepositives": [
    "System Administrators may use looks like PsExec for troubleshooting or administrations tasks. However, this will typically come only from certain users and certain systems that can be added to an allow list."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}