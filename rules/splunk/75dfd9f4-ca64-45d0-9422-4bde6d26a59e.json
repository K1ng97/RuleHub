{
  "id": "75dfd9f4-ca64-45d0-9422-4bde6d26a59e",
  "name": "CrushFTP Max Simultaneous Users From IP",
  "description": "The following analytic identifies instances where CrushFTP has blocked access due to exceeding the maximum number of simultaneous connections from a single IP address. This activity may indicate brute force attempts, credential stuffing, or automated attacks against the CrushFTP server. This detection is particularly relevant following the discovery of CVE-2025-31161, an authentication bypass vulnerability in CrushFTP versions 10.0.0 through 10.8.3 and 11.0.0 through 11.3.0.",
  "source": {
    "type": "splunk",
    "id": "75dfd9f4-ca64-45d0-9422-4bde6d26a59e",
    "url": "https://github.com/splunk/security_content/blob/develop/crushftp_max_simultaneous_users_from_ip.yml",
    "file_path": "tmp/repos/splunk/detections/web/crushftp_max_simultaneous_users_from_ip.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://www.huntress.com/blog/crushftp-cve-2025-31161-auth-bypass-and-post-exploitation",
    "https://nvd.nist.gov/vuln/detail/CVE-2025-31161",
    "https://www.crushftp.com/crush11wiki/Wiki.jsp?page=Update"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`crushftp` \"*User access not allowed.  Max simultaneous users from your IP*\" | rex field=_raw \"SESSION\\\\|\\\\d+\\\\/\\\\d+\\\\/\\\\d+ \\\\d+:\\\\d+:\\\\d+\\\\.\\\\d+\\\\|\\\\[HTTP:[^:]+:(?<user>[^:]+):(?<src_ip>[0-9\\\\.]+)\\\\]\" | stats count min(_time) as firstTime max(_time) as lastTime values(user) as user by src_ip | where count >= 3 | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `crushftp_max_simultaneous_users_from_ip_filter`",
    "condition": "To implement this detection, you need to ingest CrushFTP logs into your Splunk environment. Configure CrushFTP to forward logs to Splunk via a syslog forwarder or direct file monitoring. Ensure the sourcetype is correctly set for the CrushFTP logs. The detection requires the SESSION field and the \"[HTTP:*:user:IP]\" format in the logs. Adjust the threshold in the \"where count >= 3\" clause based on your environment's normal behavior.",
    "fields": []
  },
  "falsepositives": [
    "In environments where multiple users legitimately access CrushFTP from behind the same NAT or proxy, this may generate false positives. Tune the threshold based on your organization's usage patterns."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}