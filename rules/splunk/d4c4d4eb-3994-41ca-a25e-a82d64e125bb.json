{
  "id": "d4c4d4eb-3994-41ca-a25e-a82d64e125bb",
  "name": "AWS ECR Container Upload Outside Business Hours",
  "description": "The following analytic detects the upload of a new container image to AWS Elastic Container Registry (ECR) outside of standard business hours. It leverages AWS CloudTrail logs to identify `PutImage` events occurring between 8 PM and 8 AM or on weekends. This activity is significant because container uploads outside business hours can indicate unauthorized or suspicious activity, potentially pointing to a compromised account or insider threat. If confirmed malicious, this could allow an attacker to deploy unauthorized or malicious containers, leading to potential data breaches or service disruptions.",
  "source": {
    "type": "splunk",
    "id": "d4c4d4eb-3994-41ca-a25e-a82d64e125bb",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_ecr_container_upload_outside_business_hours.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_ecr_container_upload_outside_business_hours.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Patrick Bareiss, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1204/003/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventSource=ecr.amazonaws.com eventName=PutImage date_hour>=20 OR date_hour<8 OR date_wday=saturday OR date_wday=sunday | rename requestParameters.* as * | rename repositoryName AS repository | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime by signature user user_agent src vendor_account vendor_region vendor_product repository | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `aws_ecr_container_upload_outside_business_hours_filter`",
    "condition": "You must install splunk AWS add on and Splunk App for AWS. This search works with AWS CloudTrail logs.",
    "fields": []
  },
  "falsepositives": [
    "When your development is spreaded in different time zones, applying this rule can be difficult."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}