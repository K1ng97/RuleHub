{
  "id": "5790a766-53b8-40d3-a696-3547b978fcf0",
  "name": "Ngrok Reverse Proxy on Network",
  "description": "The following analytic detects DNS queries to common Ngrok domains, indicating potential use of the Ngrok reverse proxy tool. It leverages the Network Resolution datamodel to identify queries to domains such as \"*.ngrok.com\" and \"*.ngrok.io\". While Ngrok usage is not inherently malicious, it has been increasingly adopted by adversaries for covert communication and data exfiltration. If confirmed malicious, this activity could allow attackers to bypass network defenses, establish persistent connections, and exfiltrate sensitive data, posing a significant threat to the network's security.",
  "source": {
    "type": "splunk",
    "id": "5790a766-53b8-40d3-a696-3547b978fcf0",
    "url": "https://github.com/splunk/security_content/blob/develop/ngrok_reverse_proxy_on_network.yml",
    "file_path": "tmp/repos/splunk/detections/network/ngrok_reverse_proxy_on_network.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://www.cisa.gov/uscert/sites/default/files/publications/aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal%20network_deploy_crypto%20miner_credential_harvester.pdf"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime  from datamodel=Network_Resolution where DNS.query IN (\"*.ngrok.com\",\"*.ngrok.io\", \"ngrok.*.tunnel.com\", \"korgn.*.lennut.com\") by DNS.answer DNS.answer_count DNS.query DNS.query_count DNS.reply_code_id DNS.src DNS.vendor_product |  `drop_dm_object_name(\"DNS\")` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `ngrok_reverse_proxy_on_network_filter`",
    "condition": "The Network Resolution Datamodel will need to have data mapped to it regarding DNS queries. Modify query as needed to use another source.",
    "fields": []
  },
  "falsepositives": [
    "False positives will be present based on organizations that allow the use of Ngrok. Filter or monitor as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}