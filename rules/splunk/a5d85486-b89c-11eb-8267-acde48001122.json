{
  "id": "a5d85486-b89c-11eb-8267-acde48001122",
  "name": "Allow Inbound Traffic In Firewall Rule",
  "description": "The following analytic detects a suspicious PowerShell command that allows inbound traffic to a specific local port within the public profile. It leverages PowerShell script block logging (EventCode 4104) to identify commands containing keywords like \"firewall,\" \"Inbound,\" \"Allow,\" and \"-LocalPort.\" This activity is significant because it may indicate an attacker attempting to establish remote access by modifying firewall rules. If confirmed malicious, this could allow unauthorized access to the machine, potentially leading to further exploitation and data exfiltration.",
  "source": {
    "type": "splunk",
    "id": "a5d85486-b89c-11eb-8267-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/allow_inbound_traffic_in_firewall_rule.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/allow_inbound_traffic_in_firewall_rule.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://docs.microsoft.com/en-us/powershell/module/netsecurity/new-netfirewallrule?view=windowsserver2019-ps"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`powershell` EventCode=4104 ScriptBlockText = \"*firewall*\" ScriptBlockText = \"*Inbound*\" ScriptBlockText = \"*Allow*\"  ScriptBlockText = \"*-LocalPort*\" | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest signature signature_id user_id vendor_product EventID Guid Opcode Name Path ProcessID ScriptBlockId ScriptBlockText | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `allow_inbound_traffic_in_firewall_rule_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the powershell logs  from your endpoints. make sure you enable needed registry to monitor this event.",
    "fields": []
  },
  "falsepositives": [
    "administrator may allow inbound traffic in certain network or machine."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}