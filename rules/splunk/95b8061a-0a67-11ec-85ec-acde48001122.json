{
  "id": "95b8061a-0a67-11ec-85ec-acde48001122",
  "name": "PetitPotam Network Share Access Request",
  "description": "The following analytic detects network share access requests indicative of the PetitPotam attack (CVE-2021-36942). It leverages Windows Event Code 5145, which logs attempts to access network share objects. This detection is significant as PetitPotam can coerce authentication from domain controllers, potentially leading to unauthorized access. If confirmed malicious, this activity could allow attackers to escalate privileges or move laterally within the network, posing a severe security risk. Ensure Event Code 5145 is enabled via Group Policy to utilize this analytic effectively.",
  "source": {
    "type": "splunk",
    "id": "95b8061a-0a67-11ec-85ec-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/petitpotam_network_share_access_request.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/petitpotam_network_share_access_request.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Mauricio Velazco, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1187/",
    "https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=5145",
    "https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5145"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` SubjectUserName=\"ANONYMOUS LOGON\" EventCode=5145 RelativeTargetName=lsarpc | stats count min(_time) as firstTime max(_time) as lastTime by dest, SubjectUserSid, ShareName, src, AccessMask, AccessReason | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `petitpotam_network_share_access_request_filter`",
    "condition": "Windows Event Code 5145 is required to utilize this analytic and it may not be enabled in most environments.",
    "fields": []
  },
  "falsepositives": [
    "False positives have been limited when the Anonymous Logon is used for Account Name."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}