{
  "id": "11ebb7c2-46bd-41c9-81e1-d0b4b34583a2",
  "name": "O365 Email Transport Rule Changed",
  "description": "The following analytic identifies when a user with sufficient access to Exchange Online alters the mail flow/transport rule configuration of the organization. Transport rules are a set of rules that can be used by attackers to modify or delete emails based on specific conditions, this activity could indicate an attacker hiding or exfiltrated data.",
  "source": {
    "type": "splunk",
    "id": "11ebb7c2-46bd-41c9-81e1-d0b4b34583a2",
    "url": "https://github.com/splunk/security_content/blob/develop/o365_email_transport_rule_changed.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/o365_email_transport_rule_changed.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Steven Dick",
  "references": [
    "https://attack.mitre.org/techniques/T1114/003/",
    "https://cardinalops.com/blog/cardinalops-contributes-new-mitre-attck-techniques-related-to-abuse-of-mail-transport-rules/",
    "https://www.microsoft.com/en-us/security/blog/2022/09/22/malicious-OAuth-applications-used-to-compromise-email-servers-and-spread-spam/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`o365_management_activity` Workload=Exchange AND Operation IN (\"Set-*\",\"Disable-*\",\"New-*\",\"Remove-*\") AND Operation=\"*TransportRule\" \n| eval object_name = case('Parameters{}.Name'==\"Name\",mvindex('Parameters{}.Value',mvfind('Parameters{}.Name',\"^Name$\")),true(),ObjectId), object_id = case('Parameters{}.Name'==\"Identity\",mvindex('Parameters{}.Value',mvfind('Parameters{}.Name',\"^Identity$\")),true(),Id)\n| stats values(object_name) as object_name, min(_time) as firstTime, max(_time) as lastTime, count by object_id, UserId, Operation, signature\n| rename UserId as user\n| `security_content_ctime(firstTime)` \n| `security_content_ctime(lastTime)`\n| `o365_email_transport_rule_changed_filter`",
    "condition": "You must install the Splunk Microsoft Office 365 Add-on and ingest Office 365 management activity events.",
    "fields": []
  },
  "falsepositives": [
    "Legitimate administrative changes for business needs."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}