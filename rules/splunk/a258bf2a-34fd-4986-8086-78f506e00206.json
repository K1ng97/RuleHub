{
  "id": "a258bf2a-34fd-4986-8086-78f506e00206",
  "name": "Windows Alternate DataStream - Executable Content",
  "description": "The following analytic detects the writing of data with an IMPHASH value to an Alternate Data Stream (ADS) in the NTFS file system. It leverages Sysmon Event ID 15 and regex to identify files with a Portable Executable (PE) structure. This activity is significant as it may indicate a threat actor staging malicious code in hidden areas for persistence or future execution. If confirmed malicious, this could allow attackers to execute hidden code, maintain persistence, or escalate privileges within the environment.",
  "source": {
    "type": "splunk",
    "id": "a258bf2a-34fd-4986-8086-78f506e00206",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_alternate_datastream___executable_content.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_alternate_datastream___executable_content.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Steven Dick, Teoderick Contreras, Splunk",
  "references": [
    "https://car.mitre.org/analytics/CAR-2020-08-001/",
    "https://blogs.juniper.net/en-us/threat-research/bitpaymer-ransomware-hides-behind-windows-alternate-data-streams",
    "https://twitter.com/0xrawsec/status/1002478725605273600?s=21"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventCode=15 IMPHASH!=00000000000000000000000000000000 | regex TargetFilename=\"(?<!\\/)\\b\\w+(\\.\\w+)?:\\w+(\\.\\w+)?$\" | eval file_name = replace(TargetFilename,\"(.*\\\\\\)\",\"\"), process = Image , file_path = TargetFilename, file_hash = coalesce(SHA256,SHA1,MD5,Hash) | stats count min(_time) as firstTime max(_time) as lastTime by dest dvc file_hash file_name file_path process_exec process_guid process_id process_name process_path signature signature_id user_id vendor_product Contents Image | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_alternate_datastream___executable_content_filter`",
    "condition": "Target environment must ingest Sysmon data, specifically Event ID 15, and import hashing/imphash must be enabled within Sysmon.",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}