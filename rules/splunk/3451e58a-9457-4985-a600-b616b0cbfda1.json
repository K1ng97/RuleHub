{
  "id": "3451e58a-9457-4985-a600-b616b0cbfda1",
  "name": "O365 Multiple OS Vendors Authenticating From User",
  "description": "The following analytic identifies when multiple operating systems are used to authenticate to Azure/EntraID/Office 365 by the same user account over a short period of time. This activity could be indicative of attackers enumerating various logon capabilities of Azure/EntraID/Office 365 and attempting to discover weaknesses in the organizational MFA or conditional access configurations. Usage of the tools like \"MFASweep\" will trigger this detection.",
  "source": {
    "type": "splunk",
    "id": "3451e58a-9457-4985-a600-b616b0cbfda1",
    "url": "https://github.com/splunk/security_content/blob/develop/o365_multiple_os_vendors_authenticating_from_user.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/o365_multiple_os_vendors_authenticating_from_user.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Steven Dick",
  "references": [
    "https://attack.mitre.org/techniques/T1110",
    "https://www.blackhillsinfosec.com/exploiting-mfa-inconsistencies-on-microsoft-services/",
    "https://sra.io/blog/msspray-wait-how-many-endpoints-dont-have-mfa/",
    "https://github.com/dafthack/MFASweep/tree/master"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`o365_management_activity` Operation IN (UserLoginFailed,UserLoggedIn) \n| eval -time = _time \n| bin _time span=15m \n| fillnull \n| stats values(Operation) as signature, values(ErrorNumber) as signature_id, values(OS) as os_name, dc(OS) as os_count, count, min(-time) as firstTime, max(-time) as lastTime by ClientIP, UserId, _time, dest, vendor_account, vendor_product\n| where os_count >= 4 \n| eval src = ClientIP, user = UserId \n| `security_content_ctime(firstTime)` \n| `security_content_ctime(lastTime)` \n| `o365_multiple_os_vendors_authenticating_from_user_filter`",
    "condition": "You must install the Splunk Microsoft Office 365 Add-on and ingest Office 365 management activity events. The thresholds set within the analytic (such as unique OS) are initial guidelines and should be customized based on the organization's user behavior and risk profile. Security teams are encouraged to adjust these thresholds to optimize the balance between detecting genuine threats and minimizing false positives, ensuring the detection is tailored to their specific environment.",
    "fields": []
  },
  "falsepositives": [
    "IP or users where the usage of multiple Operating systems is expected, filter accordingly."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}