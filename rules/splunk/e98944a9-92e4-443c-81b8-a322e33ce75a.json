{
  "id": "e98944a9-92e4-443c-81b8-a322e33ce75a",
  "name": "Azure Runbook Webhook Created",
  "description": "The following analytic detects the creation of a new Automation Runbook Webhook within an Azure tenant. It leverages Azure Audit events, specifically the \"Create or Update an Azure Automation webhook\" operation, to identify this activity. This behavior is significant because Webhooks can trigger Automation Runbooks via unauthenticated URLs exposed to the Internet, posing a security risk. If confirmed malicious, an attacker could use this to execute code, create users, or maintain persistence within the environment, potentially leading to unauthorized access and control over Azure resources.",
  "source": {
    "type": "splunk",
    "id": "e98944a9-92e4-443c-81b8-a322e33ce75a",
    "url": "https://github.com/splunk/security_content/blob/develop/azure_runbook_webhook_created.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/azure_runbook_webhook_created.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://docs.microsoft.com/en-us/azure/automation/overview",
    "https://docs.microsoft.com/en-us/azure/automation/automation-runbook-types",
    "https://docs.microsoft.com/en-us/azure/automation/automation-webhooks?tabs=portal",
    "https://www.inversecos.com/2021/12/how-to-detect-malicious-azure.html",
    "https://www.netspi.com/blog/technical/cloud-penetration-testing/maintaining-azure-persistence-via-automation-accounts/",
    "https://microsoft.github.io/Azure-Threat-Research-Matrix/Persistence/AZT503/AZT503-3/",
    "https://attack.mitre.org/techniques/T1078/004/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`azure_audit` operationName.localizedValue=\"Create or Update an Azure Automation webhook\" status.value=Succeeded | dedup object | rename claims.ipaddr as src_ip | rename caller as user | stats count min(_time) as firstTime max(_time) as lastTime values(dest) as dest by object user, src_ip, resourceGroupName, object_path | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `azure_runbook_webhook_created_filter`",
    "condition": "You must install the latest version of Splunk Add-on for Microsoft Cloud Services from Splunkbase (https://splunkbase.splunk.com/app/3110/#/details). You must be ingesting Azure Audit events into your Splunk environment. Specifically, this analytic leverages the Azure Activity log category.",
    "fields": []
  },
  "falsepositives": [
    "Administrators may legitimately create Azure Runbook Webhooks. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}