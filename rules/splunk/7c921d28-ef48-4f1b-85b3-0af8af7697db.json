{
  "id": "7c921d28-ef48-4f1b-85b3-0af8af7697db",
  "name": "AWS Defense Evasion Update Cloudtrail",
  "description": "The following analytic detects `UpdateTrail` events in AWS CloudTrail logs. It identifies attempts to modify CloudTrail settings, potentially to evade logging. The detection leverages CloudTrail logs, focusing on `UpdateTrail` events where the user agent is not the AWS console and the operation is successful. This activity is significant because altering CloudTrail settings can disable or limit logging, hindering visibility into AWS account activities. If confirmed malicious, this could allow attackers to operate undetected, compromising the integrity and security of the AWS environment.",
  "source": {
    "type": "splunk",
    "id": "7c921d28-ef48-4f1b-85b3-0af8af7697db",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_defense_evasion_update_cloudtrail.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_defense_evasion_update_cloudtrail.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Gowthamaraj Rajendran, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1562/008/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName = UpdateTrail eventSource = cloudtrail.amazonaws.com userAgent !=console.amazonaws.com errorCode = success | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime by signature dest user user_agent src vendor_account vendor_region vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`| `aws_defense_evasion_update_cloudtrail_filter`",
    "condition": "You must install Splunk AWS Add on and enable CloudTrail logs in your AWS Environment.",
    "fields": []
  },
  "falsepositives": [
    "While this search has no known false positives, it is possible that an AWS admin has updated cloudtrail logging. Please investigate this activity."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}