{
  "id": "e40ef542-8241-4419-9af4-6324582ea60a",
  "name": "Windows KrbRelayUp Service Creation",
  "description": "The following analytic detects the creation of a service with the default name \"KrbSCM\" associated with the KrbRelayUp tool. It leverages Windows System Event Logs, specifically EventCode 7045, to identify this activity. This behavior is significant as KrbRelayUp is a known tool used for privilege escalation attacks. If confirmed malicious, this activity could allow an attacker to escalate privileges, potentially gaining unauthorized access to sensitive systems and data.",
  "source": {
    "type": "splunk",
    "id": "e40ef542-8241-4419-9af4-6324582ea60a",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_krbrelayup_service_creation.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_krbrelayup_service_creation.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://github.com/Dec0ne/KrbRelayUp"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_system` EventCode=7045 ServiceName IN (\"KrbSCM\") | stats count min(_time) as firstTime max(_time) as lastTime by dest EventCode ImagePath ServiceName StartType ServiceType | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_krbrelayup_service_creation_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Windows System Event Logs with 7045 EventCode enabled. The Windows TA is also required.",
    "fields": []
  },
  "falsepositives": [
    "False positives should be limited as this is specific to KrbRelayUp based attack. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}