{
  "id": "2a9b80d3-6340-4345-11ad-212bf444d111",
  "name": "AWS CreateLoginProfile",
  "description": "The following analytic identifies the creation of a login profile for one AWS user by another, followed by a console login from the same source IP. It uses AWS CloudTrail logs to correlate the `CreateLoginProfile` and `ConsoleLogin` events based on the source IP and user identity. This activity is significant as it may indicate privilege escalation, where an attacker creates a new login profile to gain unauthorized access. If confirmed malicious, this could allow the attacker to escalate privileges and maintain persistent access to the AWS environment.",
  "source": {
    "type": "splunk",
    "id": "2a9b80d3-6340-4345-11ad-212bf444d111",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_createloginprofile.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_createloginprofile.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Bhavin Patel, Splunk",
  "references": [
    "https://bishopfox.com/blog/privilege-escalation-in-aws",
    "https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation-part-2/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName = CreateLoginProfile | rename requestParameters.userName as new_login_profile | table src_ip eventName new_login_profile userIdentity.userName | join new_login_profile src_ip [| search `cloudtrail` eventName = ConsoleLogin | rename userIdentity.userName  as new_login_profile | stats count values(eventName) min(_time) as firstTime max(_time) as lastTime by eventSource aws_account_id errorCode user_agent eventID awsRegion userIdentity.principalId user_arn new_login_profile src_ip dest vendor_account vendor_region vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`] | rename user_arn as user | `aws_createloginprofile_filter`",
    "condition": "You must install splunk AWS add on and Splunk App for AWS. This search works with AWS CloudTrail logs.",
    "fields": []
  },
  "falsepositives": [
    "While this search has no known false positives, it is possible that an AWS admin has legitimately created a login profile for another user."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}