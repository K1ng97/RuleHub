{
  "id": "3d8d3a36-93b8-42d7-8d91-c5f24cec223d",
  "name": "Azure AD Unusual Number of Failed Authentications From Ip",
  "description": "The following analytic identifies a single source IP failing to authenticate with multiple valid users, potentially indicating a Password Spraying attack against an Azure Active Directory tenant. It uses Azure SignInLogs data and calculates the standard deviation for source IPs, applying the 3-sigma rule to detect unusual numbers of failed authentication attempts. This activity is significant as it may signal an adversary attempting to gain initial access or elevate privileges. If confirmed malicious, this could lead to unauthorized access, privilege escalation, and potential compromise of sensitive information.",
  "source": {
    "type": "splunk",
    "id": "3d8d3a36-93b8-42d7-8d91-c5f24cec223d",
    "url": "https://github.com/splunk/security_content/blob/develop/azure_ad_unusual_number_of_failed_authentications_from_ip.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/azure_ad_unusual_number_of_failed_authentications_from_ip.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Gowthamaraj Rajendran, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1110/003/",
    "https://docs.microsoft.com/en-us/security/compass/incident-response-playbook-password-spray",
    "https://www.cisa.gov/uscert/ncas/alerts/aa21-008a",
    "https://docs.microsoft.com/azure/active-directory/reports-monitoring/reference-sign-ins-error-codes"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`azure_monitor_aad` category=SignInLogs properties.status.errorCode=50126 properties.authenticationDetails{}.succeeded=false | rename properties.* as * | bucket span=5m _time | stats dc(userPrincipalName) AS unique_accounts values(userPrincipalName) as userPrincipalName values(dest) as dest  values(user) as user by _time, src, vendor_account, vendor_product | eventstats avg(unique_accounts) as ip_avg, stdev(unique_accounts) as ip_std by src | eval upperBound=(ip_avg+ip_std*3) | eval isOutlier=if(unique_accounts > 10 and unique_accounts >= upperBound, 1,0) | where isOutlier = 1 | `azure_ad_unusual_number_of_failed_authentications_from_ip_filter`",
    "condition": "You must install the latest version of Splunk Add-on for Microsoft Cloud Services from Splunkbase (https://splunkbase.splunk.com/app/3110/#/details). You must be ingesting Azure Active Directory events into your Splunk environment through an EventHub. This analytic was written to be used with the azure:monitor:aad sourcetype leveraging the Signin log category.",
    "fields": []
  },
  "falsepositives": [
    "A source Ip failing to authenticate with multiple users is not a common for legitimate behavior."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}