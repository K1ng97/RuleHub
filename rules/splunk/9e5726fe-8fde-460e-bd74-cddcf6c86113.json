{
  "id": "9e5726fe-8fde-460e-bd74-cddcf6c86113",
  "name": "VMware Workspace ONE Freemarker Server-side Template Injection",
  "description": "The following analytic detects server-side template injection attempts related to CVE-2022-22954 in VMware Workspace ONE. It leverages web or proxy logs to identify HTTP GET requests to the endpoint catalog-portal/ui/oauth/verify with the freemarker.template.utility.Execute command. This activity is significant as it indicates potential exploitation attempts that could lead to remote code execution. If confirmed malicious, an attacker could execute arbitrary commands on the server, leading to full system compromise, data exfiltration, or further lateral movement within the network.",
  "source": {
    "type": "splunk",
    "id": "9e5726fe-8fde-460e-bd74-cddcf6c86113",
    "url": "https://github.com/splunk/security_content/blob/develop/vmware_workspace_one_freemarker_server_side_template_injection.yml",
    "file_path": "tmp/repos/splunk/detections/web/vmware_workspace_one_freemarker_server_side_template_injection.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://www.cisa.gov/uscert/ncas/alerts/aa22-138b",
    "https://github.com/wvu/metasploit-framework/blob/master/modules/exploits/linux/http/vmware_workspace_one_access_cve_2022_22954.rb",
    "https://github.com/sherlocksecurity/VMware-CVE-2022-22954",
    "https://www.vmware.com/security/advisories/VMSA-2022-0011.html",
    "https://attackerkb.com/topics/BDXyTqY1ld/cve-2022-22954/rapid7-analysis"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats count from datamodel=Web where Web.http_method IN (\"GET\") Web.url=\"*/catalog-portal/ui/oauth/verify?error=&deviceudid=*\" AND Web.url=\"*freemarker.template.utility.Execute*\" by Web.http_user_agent Web.http_method, Web.url,Web.url_length Web.src, Web.dest sourcetype | `drop_dm_object_name(\"Web\")` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `vmware_workspace_one_freemarker_server_side_template_injection_filter`",
    "condition": "To successfully implement this search, you need to be ingesting web or proxy logs, or ensure it is being filled by a proxy like device, into the Web Datamodel. For additional filtering, allow list private IP space or restrict by known good.",
    "fields": []
  },
  "falsepositives": [
    "False positives may be present if the activity is blocked or was not successful. Filter known vulnerablity scanners. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}