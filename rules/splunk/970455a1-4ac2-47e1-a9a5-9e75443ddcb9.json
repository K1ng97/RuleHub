{
  "id": "970455a1-4ac2-47e1-a9a5-9e75443ddcb9",
  "name": "Windows PowerView Kerberos Service Ticket Request",
  "description": "The following analytic detects the execution of the `Get-DomainSPNTicket` commandlet, part of the PowerView tool, by leveraging PowerShell Script Block Logging (EventCode=4104). This commandlet requests Kerberos service tickets for specified service principal names (SPNs). Monitoring this activity is crucial as it can indicate attempts to perform Kerberoasting, a technique used to extract SPN account passwords via cracking tools like hashcat. If confirmed malicious, this activity could allow attackers to gain unauthorized access to sensitive accounts, potentially leading to privilege escalation and further network compromise.",
  "source": {
    "type": "splunk",
    "id": "970455a1-4ac2-47e1-a9a5-9e75443ddcb9",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_powerview_kerberos_service_ticket_request.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_powerview_kerberos_service_ticket_request.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Gowthamaraj Rajendran, Splunk",
  "references": [
    "https://powersploit.readthedocs.io/en/latest/Recon/Get-DomainSPNTicket/",
    "https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast",
    "https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1",
    "https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting",
    "https://attack.mitre.org/techniques/T1558/003"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`powershell` EventCode=4104 ScriptBlockText=*Get-DomainSPNTicket* | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest signature signature_id user_id vendor_product EventID Guid Opcode Name Path ProcessID ScriptBlockId ScriptBlockText | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_powerview_kerberos_service_ticket_request_filter`",
    "condition": "The following analytic requires PowerShell operational logs to be imported. Modify the powershell macro as needed to match the sourcetype or add index. This analytic is specific to 4104, or PowerShell Script Block Logging.",
    "fields": []
  },
  "falsepositives": [
    "False positive may include Administrators using PowerView for troubleshooting and management."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}