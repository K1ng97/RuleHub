{
  "id": "d92f2d95-05fb-48a7-910f-4d3d61ab8655",
  "name": "Windows Administrative Shares Accessed On Multiple Hosts",
  "description": "The following analytic detects a source computer accessing Windows administrative shares (C$, Admin$, IPC$) on 30 or more remote endpoints within a 5-minute window. It leverages Event IDs 5140 and 5145 from file share events. This behavior is significant as it may indicate an adversary enumerating network shares to locate sensitive files, a common tactic used by threat actors. If confirmed malicious, this activity could lead to unauthorized access to critical data, lateral movement, and potential compromise of multiple systems within the network.",
  "source": {
    "type": "splunk",
    "id": "d92f2d95-05fb-48a7-910f-4d3d61ab8655",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_administrative_shares_accessed_on_multiple_hosts.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_administrative_shares_accessed_on_multiple_hosts.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1135/",
    "https://en.wikipedia.org/wiki/Administrative_share",
    "https://thedfirreport.com/2023/01/23/sharefinder-how-threat-actors-discover-file-shares/",
    "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5140",
    "https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5145"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=5140 OR EventCode=5145 (ShareName=\"\\\\\\\\*\\\\ADMIN$\" OR ShareName=\"\\\\\\\\*\\\\IPC$\" OR ShareName=\"\\\\\\\\*\\\\C$\") | bucket span=5m _time | stats dc(Computer) AS unique_targets values(Computer) as host_targets values(ShareName) as shares values(dest) as dest by _time, IpAddress, SubjectUserName, EventCode | where unique_targets > 30 | `windows_administrative_shares_accessed_on_multiple_hosts_filter`",
    "condition": "To successfully implement this search, you need to be ingesting file share events. The Advanced Security Audit policy setting `Audit Detailed File Share` or `Audit File Share` within `Object Access` need to be enabled.",
    "fields": []
  },
  "falsepositives": [
    "An single endpoint accessing windows administrative shares across a large number of endpoints is not common behavior. Possible false positive scenarios include but are not limited to vulnerability scanners, administration systems and missconfigured systems."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}