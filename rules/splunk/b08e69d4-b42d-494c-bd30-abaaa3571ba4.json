{
  "id": "b08e69d4-b42d-494c-bd30-abaaa3571ba4",
  "name": "Cisco Secure Firewall - Bits Network Activity",
  "description": "The following analytic detects the use of the Background Intelligent Transfer Service (BITS) client application in allowed outbound connections. It leverages logs from Cisco Secure Firewall Threat Defense devices and identifies instances where BITS is used to initiate downloads from non-standard or unexpected domains. While BITS is a legitimate Windows service used for downloading updates, it is also commonly abused by adversaries to stealthily retrieve payloads or tools. This analytic filters out known Microsoft Edge update URLs and focuses on connections that may indicate suspicious or unauthorized file transfers. If confirmed malicious, this could represent a command and control (C2) channel or a download of malware or tooling as part of an attack chain.",
  "source": {
    "type": "splunk",
    "id": "b08e69d4-b42d-494c-bd30-abaaa3571ba4",
    "url": "https://github.com/splunk/security_content/blob/develop/cisco_secure_firewall___bits_network_activity.yml",
    "file_path": "tmp/repos/splunk/detections/network/cisco_secure_firewall___bits_network_activity.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Nasreddine Bencherchali, Splunk",
  "references": [
    "https://www.cisco.com/c/en/us/td/docs/security/firepower/741/api/FQE/secure_firewall_estreamer_fqe_guide_740.pdf"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cisco_secure_firewall` EventType=ConnectionEvent action=Allow ClientApplication=\"BITS\" AND NOT url IN (\"*://msedge.b.tlu.dl*\")\n| stats count min(_time) as firstTime max(_time) as lastTime by src_ip, dest, dest_port, transport, rule, url, EVE_Process, ClientApplication, ClientApplicationVersion, action\n| `security_content_ctime(firstTime)` \n| `security_content_ctime(lastTime)` \n| `cisco_secure_firewall___bits_network_activity_filter`\n",
    "condition": "This search requires Cisco Secure Firewall Threat Defense Logs, which\nincludes the ConnectionEvent EventType. This search uses an input macro named `cisco_secure_firewall`.\nWe strongly recommend that you specify your environment-specific configurations\n(index, source, sourcetype, etc.) for Cisco Secure Firewall Threat Defense logs. Replace the macro definition\nwith configurations for your Splunk environment. The search also uses a post-filter\nmacro designed to filter out known false positives.\nThe logs are to be ingested using the Splunk Add-on for Cisco Security Cloud (https://splunkbase.splunk.com/app/7404).\nThe access policy must also enable logging.\n",
    "fields": []
  },
  "falsepositives": [
    "BITS is a legitimate Windows component used by Microsoft services such as Windows Update or Microsoft Edge for downloading updates.\nAlthough this analytic filters known Microsoft Edge update URLs, false positives may still occur from other legitimate enterprise applications or software distribution platforms that utilize BITS.\nAdditional tuning may be required to account for internal application distribution systems or approved update mechanisms that also rely on BITS.\n"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}