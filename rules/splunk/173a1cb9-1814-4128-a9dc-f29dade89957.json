{
  "id": "173a1cb9-1814-4128-a9dc-f29dade89957",
  "name": "Cisco Secure Firewall - Wget or Curl Download",
  "description": "The following analytic detects outbound connections initiated by command-line tools such as curl or wget. It leverages Cisco Secure Firewall Threat Defense logs and identifies allowed connections (action=Allow) where either the EVE_Process or ClientApplication fields indicate use of these utilities. While curl and wget are legitimate tools commonly used for software updates and scripting, adversaries often abuse them to download payloads, retrieve additional tools, or establish staging infrastructure from compromised systems. If confirmed malicious, this behavior may indicate the download phase of an attack chain or a command-and-control utility retrieval.\n",
  "source": {
    "type": "splunk",
    "id": "173a1cb9-1814-4128-a9dc-f29dade89957",
    "url": "https://github.com/splunk/security_content/blob/develop/cisco_secure_firewall___wget_or_curl_download.yml",
    "file_path": "tmp/repos/splunk/detections/network/cisco_secure_firewall___wget_or_curl_download.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Nasreddine Bencherchali, Splunk",
  "references": [
    "https://www.cisco.com/c/en/us/td/docs/security/firepower/741/api/FQE/secure_firewall_estreamer_fqe_guide_740.pdf"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cisco_secure_firewall` EventType=ConnectionEvent action=Allow AND ( EVE_Process IN (\"*curl*\", \"*wget*\") OR ClientApplication IN (\"cURL\", \"Wget\") )\n| stats count min(_time) as firstTime max(_time) as lastTime\n    Values(rule) as rule\n    Values(url) as url\n    Values(dest_port) as dest_port\n    Values(ClientApplicationVersion) as ClientApplicationVersion\n    Values(src_port) as src_port\n    by src_ip, dest, transport, EVE_Process, ClientApplication, action\n| table src_ip src_port dest dest_port transport url EVE_Process ClientApplication ClientApplicationVersion rule firstTime lastTime\n| `security_content_ctime(firstTime)`\n| `security_content_ctime(lastTime)` \n| `cisco_secure_firewall___wget_or_curl_download_filter`\n",
    "condition": "This search requires Cisco Secure Firewall Threat Defense Logs, which\nincludes the ConnectionEvent EventType. This search uses an input macro named `cisco_secure_firewall`.\nWe strongly recommend that you specify your environment-specific configurations\n(index, source, sourcetype, etc.) for Cisco Secure Firewall Threat Defense logs. Replace the macro definition\nwith configurations for your Splunk environment. The search also uses a post-filter\nmacro designed to filter out known false positives.\nThe logs are to be ingested using the Splunk Add-on for Cisco Security Cloud (https://splunkbase.splunk.com/app/7404).\nThe access policy must also enable logging.\n",
    "fields": []
  },
  "falsepositives": [
    "Developers, administrators, or automation tools may use `curl` or `wget` for legitimate purposes such as software installation, configuration scripts, or CI/CD tasks.\nSecurity tools or health monitoring scripts may also use these utilities to check service availability or download updates.\nReview the destination `url`, frequency, and process context to validate whether the download activity is authorized.\n"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}