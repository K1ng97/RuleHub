{
  "id": "97a8dc5f-8a7c-4fed-9e3e-ec407fd0268a",
  "name": "Windows Computer Account Created by Computer Account",
  "description": "The following analytic identifies a computer account creating a new computer account with a specific Service Principal Name (SPN) \"RestrictedKrbHost\". This detection leverages Windows Security Event Logs, specifically EventCode 4741, to identify such activities. This behavior is significant as it may indicate an attempt to establish unauthorized Kerberos authentication channels, potentially leading to lateral movement or privilege escalation. If confirmed malicious, this activity could allow an attacker to impersonate services, access sensitive information, or maintain persistence within the network.",
  "source": {
    "type": "splunk",
    "id": "97a8dc5f-8a7c-4fed-9e3e-ec407fd0268a",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_computer_account_created_by_computer_account.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_computer_account_created_by_computer_account.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-kile/445e4499-7e49-4f2a-8d82-aaf2d1ee3c47",
    "https://github.com/Dec0ne/KrbRelayUp"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=4741 user_type=computer SubjectDomainName!=\"NT AUTHORITY\" ServicePrincipalNames=*RestrictedKrbHost* | stats  count min(_time) as firstTime max(_time) as lastTime by dest, subject, action ,src_user, user, user_type, SubjectUserName,SubjectDomainName | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_computer_account_created_by_computer_account_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Windows Security Event Logs with 4741 EventCode enabled. The Windows TA is also required.",
    "fields": []
  },
  "falsepositives": [
    "It is possible third party applications may have a computer account that adds computer accounts, filtering may be required."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}