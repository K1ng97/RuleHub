{
  "id": "5a5351cd-ba7e-499e-ad82-2ce160ffa637",
  "name": "Windows Privilege Escalation System Process Without System Parent",
  "description": "The following analytic detects any system integrity level process spawned by a non-system account. It leverages Sysmon EventID 1, focusing on process integrity and parent user data. This behavior is significant as it often indicates successful privilege escalation to SYSTEM from a user-controlled process or service. If confirmed malicious, this activity could allow an attacker to gain full control over the system, execute arbitrary code, and potentially compromise the entire environment.",
  "source": {
    "type": "splunk",
    "id": "5a5351cd-ba7e-499e-ad82-2ce160ffa637",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_privilege_escalation_system_process_without_system_parent.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_privilege_escalation_system_process_without_system_parent.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Steven Dick",
  "references": [
    "https://attack.mitre.org/techniques/T1068/",
    "https://vuls.cert.org/confluence/display/Wiki/2021/06/21/Finding+Privilege+Escalation+Vulnerabilities+in+Windows+using+Process+Monitor",
    "https://redcanary.com/blog/getsystem-offsec/",
    "https://atomicredteam.io/privilege-escalation/T1134.001/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventCode=1 IntegrityLevel=\"system\" ParentUser=* NOT ParentUser IN (\"*SYSTEM\",\"*LOCAL SERVICE\",\"*NETWORK SERVICE\",\"*DWM-*\",\"*$\",\"-\") | eval src_user = replace(ParentUser,\"^[^\\\\\\]+\\\\\\\\\",\"\") | stats count min(_time) as firstTime max(_time) as lastTime by action dest original_file_name parent_process parent_process_exec parent_process_guid parent_process_id parent_process_name parent_process_path process process_exec process_guid process_hash process_id process_integrity_level process_name process_path user user_id vendor_product src_user | `security_content_ctime(firstTime)`  | `security_content_ctime(lastTime)` | `windows_privilege_escalation_system_process_without_system_parent_filter`",
    "condition": "Target environment must ingest sysmon data, specifically Event ID 1 with process integrity and parent user data.",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}