{
  "id": "953322db-128a-4ce9-8e89-56e039e33d98",
  "name": "Windows Suspect Process With Authentication Traffic",
  "description": "The following analytic detects executables running from public or temporary locations that are communicating over Windows domain authentication ports/protocols such as LDAP (389), LDAPS (636), and Kerberos (88). It leverages network traffic data to identify processes originating from user-controlled directories. This activity is significant because legitimate applications rarely run from these locations and attempt domain authentication, making it a potential indicator of compromise. If confirmed malicious, attackers could leverage this to access domain resources, potentially leading to further exploitation and lateral movement within the network.",
  "source": {
    "type": "splunk",
    "id": "953322db-128a-4ce9-8e89-56e039e33d98",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_suspect_process_with_authentication_traffic.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_suspect_process_with_authentication_traffic.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Steven Dick",
  "references": [
    "https://attack.mitre.org/techniques/T1069/002/",
    "https://book.hacktricks.xyz/network-services-pentesting/pentesting-kerberos-88"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(All_Traffic.process_id) as process_id  from datamodel=Network_Traffic.All_Traffic where All_Traffic.dest_port IN (\"88\",\"389\",\"636\")  AND All_Traffic.app IN (\"*\\\\users\\\\*\", \"*\\\\programdata\\\\*\", \"*\\\\temp\\\\*\", \"*\\\\Windows\\\\Tasks\\\\*\", \"*\\\\appdata\\\\*\", \"*\\\\perflogs\\\\*\") by All_Traffic.action All_Traffic.app All_Traffic.dest All_Traffic.dest_ip All_Traffic.dest_port All_Traffic.direction All_Traffic.dvc All_Traffic.protocol All_Traffic.protocol_version All_Traffic.src All_Traffic.src_ip All_Traffic.src_port All_Traffic.transport All_Traffic.user All_Traffic.vendor_product | `drop_dm_object_name(All_Traffic)`  | rex field=app \".*\\\\\\(?<process_name>.*)$\" | `security_content_ctime(firstTime)`  | `security_content_ctime(lastTime)` | `windows_suspect_process_with_authentication_traffic_filter`",
    "condition": "To implement this analytic, Sysmon should be installed in the environment and generating network events for  userland and/or known public writable locations.",
    "fields": []
  },
  "falsepositives": [
    "Known applications running from these locations for legitimate purposes. Targeting only kerberos (port 88) may significantly reduce noise."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}