{
  "id": "18916468-9c04-11ec-bdc6-acde48001122",
  "name": "Kerberos TGT Request Using RC4 Encryption",
  "description": "The following analytic detects a Kerberos Ticket Granting Ticket (TGT) request using RC4-HMAC encryption (type 0x17) by leveraging Event 4768. This encryption type is outdated and its presence may indicate an OverPass The Hash attack. Monitoring this activity is crucial as it can signify credential theft, allowing adversaries to authenticate to the Kerberos Distribution Center (KDC) using a stolen NTLM hash. If confirmed malicious, this could enable unauthorized access to systems and resources, potentially leading to lateral movement and further compromise within the network.",
  "source": {
    "type": "splunk",
    "id": "18916468-9c04-11ec-bdc6-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/kerberos_tgt_request_using_rc4_encryption.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/kerberos_tgt_request_using_rc4_encryption.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://stealthbits.com/blog/how-to-detect-overpass-the-hash-attacks/",
    "https://www.thehacker.recipes/ad/movement/kerberos/ptk",
    "https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4768"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=4768 TicketEncryptionType=0x17 ServiceName!=*$ | stats count min(_time) as firstTime max(_time) as lastTime by ServiceName src_ip dest | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `kerberos_tgt_request_using_rc4_encryption_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Domain Controller and Kerberos events. The Advanced Security Audit policy setting `Audit Kerberos Authentication Service` within `Account Logon` needs to be enabled.",
    "fields": []
  },
  "falsepositives": [
    "Based on Microsoft documentation, legacy systems or applications will use RC4-HMAC as the default encryption for TGT requests. Specifically, systems before Windows Server 2008 and Windows Vista. Newer systems will use AES128 or AES256."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}