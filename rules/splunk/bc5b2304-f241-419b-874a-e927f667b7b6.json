{
  "id": "bc5b2304-f241-419b-874a-e927f667b7b6",
  "name": "Windows Scheduled Task DLL Module Loaded",
  "description": "The following analytic detects instances where the taskschd.dll is loaded by processes running in suspicious or writable directories. This activity is unusual, as legitimate processes that load taskschd.dll typically reside in protected system locations. Malware or threat actors may attempt to load this DLL from writable or non-standard directories to manipulate the Task Scheduler and execute malicious tasks. By identifying processes that load taskschd.dll in these unsafe locations, this detection helps security analysts flag potentially malicious activity and investigate further to prevent unauthorized system modifications.",
  "source": {
    "type": "splunk",
    "id": "bc5b2304-f241-419b-874a-e927f667b7b6",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_scheduled_task_dll_module_loaded.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_scheduled_task_dll_module_loaded.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://www.proofpoint.com/us/blog/threat-insight/chinese-malware-appears-earnest-across-cybercrime-threat-landscape",
    "https://www.fortinet.com/blog/threat-research/valleyrat-campaign-targeting-chinese-speakers"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventCode=7 Image IN (\"*\\\\windows\\\\fonts\\\\*\", \"*\\\\windows\\\\temp\\\\*\", \"*\\\\users\\\\public\\\\*\", \"*\\\\windows\\\\debug\\\\*\", \"*\\\\Users\\\\Administrator\\\\Music\\\\*\", \"*\\\\Windows\\\\servicing\\\\*\", \"*\\\\Users\\\\Default\\\\*\", \"*Recycle.bin*\", \"*\\\\Windows\\\\Media\\\\*\", \"\\\\Windows\\\\repair\\\\*\", \"*\\\\temp\\\\*\", \"*\\\\PerfLogs\\\\*\") ImageLoaded = \"*\\\\taskschd.dll\" | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by Image ImageLoaded dest loaded_file loaded_file_path original_file_name process_exec process_guid process_hash process_id process_name process_path service_dll_signature_exists service_dll_signature_verified signature signature_id user_id vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_scheduled_task_dll_module_loaded_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the process name and imageloaded executions from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",
    "fields": []
  },
  "falsepositives": [
    "Third party Legitimate application may load this task schedule dll module."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}