{
  "id": "ac59298a-8d81-4c02-8c9b-ffdac993891f",
  "name": "Windows Modify Registry ValleyRAT C2 Config",
  "description": "The following analytic detects modifications to theregistry related to ValleyRAT C2 configuration. Specifically,  it monitors changes in registry keys where ValleyRAT saves the IP address and port information of its command-and-control (C2) server. This activity is a key indicator of ValleyRAT attempting to establish persistent communication with its C2 infrastructure. By identifying these unauthorized registry modifications, security analysts can quickly detect malicious configurations and investigate the associated threats. Early detection of these changes helps prevent further exploitation and limits the malwareâ€™s ability to exfiltrate data or control infected systems.",
  "source": {
    "type": "splunk",
    "id": "ac59298a-8d81-4c02-8c9b-ffdac993891f",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_modify_registry_valleyrat_c2_config.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_modify_registry_valleyrat_c2_config.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://www.proofpoint.com/us/blog/threat-insight/chinese-malware-appears-earnest-across-cybercrime-threat-landscape",
    "https://www.fortinet.com/blog/threat-research/valleyrat-campaign-targeting-chinese-speakers"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats `security_content_summariesonly` count FROM datamodel=Endpoint.Registry WHERE (Registry.registry_path= \"*\\\\Console\\\\IpDateInfo\" AND Registry.registry_value_data=\"Binary Data\") OR (Registry.registry_path= \"*\\\\Console\\\\SelfPath\" AND Registry.registry_value_data=\"*.exe\") by Registry.action Registry.dest Registry.process_guid Registry.process_id Registry.registry_hive Registry.registry_path Registry.registry_key_name Registry.registry_value_data Registry.registry_value_name Registry.registry_value_type Registry.status Registry.user Registry.vendor_product | `drop_dm_object_name(Registry)` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_modify_registry_valleyrat_c2_config_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the registry value name, registry path, and registry value data from your endpoints. If you are using Sysmon, you must have at least version 2.0 of the official Sysmon TA. https://splunkbase.splunk.com/app/5709",
    "fields": []
  },
  "falsepositives": [
    "unknown"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}