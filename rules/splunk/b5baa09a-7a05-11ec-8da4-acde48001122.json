{
  "id": "b5baa09a-7a05-11ec-8da4-acde48001122",
  "name": "Excessive File Deletion In WinDefender Folder",
  "description": "The following analytic detects excessive file deletion events in the Windows Defender folder. It leverages Sysmon EventCodes 23 and 26 to identify processes deleting multiple files within this directory. This behavior is significant as it may indicate an attempt to corrupt or disable Windows Defender, a key security component. If confirmed malicious, this activity could allow an attacker to disable endpoint protection, facilitating further malicious actions without detection.",
  "source": {
    "type": "splunk",
    "id": "b5baa09a-7a05-11ec-8da4-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/excessive_file_deletion_in_windefender_folder.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/excessive_file_deletion_in_windefender_folder.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk, Steven Dick",
  "references": [
    "https://www.microsoft.com/security/blog/2022/01/15/destructive-malware-targeting-ukrainian-organizations/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventCode IN (\"23\",\"26\") TargetFilename = \"*\\\\ProgramData\\\\Microsoft\\\\Windows Defender\\\\*\" | stats count min(_time) as firstTime, max(_time) as lastTime values(file_path) as file_path values(file_hash) as file_hash values(file_name) as file_name values(file_modify_time) as file_modify_time values(process_name) as process_name values(process_path) as process_path values(process_guid) as process_guid values(process_id) as process_id values(process_exec) as process_exec by action dest dvc signature signature_id user user_id vendor_product | where count >=50 | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `excessive_file_deletion_in_windefender_folder_filter`",
    "condition": "To successfully implement this search, you must ingest logs that include the process name, TargetFilename, and ProcessID executions from your endpoints. If you are utilizing Sysmon, ensure you have at least version 2.0 of the Sysmon TA installed.",
    "fields": []
  },
  "falsepositives": [
    "Windows Defender AV updates may trigger this alert. Please adjust the filter macros to mitigate false positives."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}