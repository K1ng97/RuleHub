{
  "id": "2820f032-19eb-497e-8642-25b04a880359",
  "name": "LOLBAS With Network Traffic",
  "description": "The following analytic identifies the use of Living Off the Land Binaries and Scripts (LOLBAS) with network traffic. It leverages data from the Network Traffic data model to detect when native Windows binaries, often abused by adversaries, initiate network connections. This activity is significant as LOLBAS are frequently used to download malicious payloads, enabling lateral movement, command-and-control, or data exfiltration. If confirmed malicious, this behavior could allow attackers to execute arbitrary code, escalate privileges, or maintain persistence within the environment, posing a severe threat to organizational security.",
  "source": {
    "type": "splunk",
    "id": "2820f032-19eb-497e-8642-25b04a880359",
    "url": "https://github.com/splunk/security_content/blob/develop/lolbas_with_network_traffic.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/lolbas_with_network_traffic.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Steven Dick",
  "references": [
    "https://lolbas-project.github.io/#",
    "https://www.sans.org/presentations/lolbin-detection-methods-seven-common-attacks-revealed/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime from datamodel=Network_Traffic.All_Traffic where (All_Traffic.app IN (\"*Regsvcs.exe\", \"*\\\\Ftp.exe\", \"*OfflineScannerShell.exe\", \"*Rasautou.exe\", \"*Schtasks.exe\", \"*Xwizard.exe\", \"*Pnputil.exe\", \"*Atbroker.exe\", \"*Pcwrun.exe\", \"*Ttdinject.exe\", \"*Mshta.exe\", \"*Bitsadmin.exe\", \"*Certoc.exe\", \"*Ieexec.exe\", \"*Microsoft.Workflow.Compiler.exe\", \"*Runscripthelper.exe\", \"*Forfiles.exe\", \"*Msbuild.exe\", \"*Register-cimprovider.exe\", \"*Tttracer.exe\", \"*Ie4uinit.exe\", \"*Bash.exe\", \"*Hh.exe\", \"*SettingSyncHost.exe\", \"*Cmstp.exe\", \"*Stordiag.exe\", \"*Scriptrunner.exe\", \"*Odbcconf.exe\", \"*Extexport.exe\", \"*Msdt.exe\", \"*WorkFolders.exe\", \"*Diskshadow.exe\", \"*Mavinject.exe\", \"*Regasm.exe\", \"*Gpscript.exe\", \"*Regsvr32.exe\", \"*Msiexec.exe\", \"*Wuauclt.exe\", \"*Presentationhost.exe\", \"*Wmic.exe\", \"*Runonce.exe\", \"*Syncappvpublishingserver.exe\", \"*Verclsid.exe\", \"*Infdefaultinstall.exe\", \"*Installutil.exe\", \"*Netsh.exe\", \"*Wab.exe\", \"*Dnscmd.exe\", \"*\\\\At.exe\", \"*Pcalua.exe\", \"*Msconfig.exe\", \"*makecab.exe\", \"*cscript.exe\", \"*notepad.exe\", \"*\\\\cmd.exe\", \"*certutil.exe\", \"*\\\\powershell.exe\", \"*powershell_ise.exe\", \"*\\\\pwsh.exe\")) by All_Traffic.action All_Traffic.app All_Traffic.dest All_Traffic.dest_ip All_Traffic.dest_port All_Traffic.direction All_Traffic.dvc All_Traffic.protocol All_Traffic.protocol_version All_Traffic.src All_Traffic.src_ip All_Traffic.src_port All_Traffic.transport All_Traffic.user All_Traffic.vendor_product | `drop_dm_object_name(All_Traffic)` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | rex field=app \".*\\\\\\(?<process_name>.*)$\" | `lolbas_with_network_traffic_filter`",
    "condition": "To successfully implement this detection you must ingest events into the Network traffic data model that contain the source, destination, and communicating process in the app field. Relevant processes must also be ingested in the Endpoint data model with matching process_id field. Sysmon EID1 and EID3 are good examples of this type this data type.",
    "fields": []
  },
  "falsepositives": [
    "Legitimate usage of internal automation or scripting, especially powershell.exe or pwsh.exe, internal to internal or logon scripts. It may be necessary to omit internal IP ranges if extremely noisy. ie NOT dest_ip IN (\"10.0.0.0/8\",\"172.16.0.0/12\",\"192.168.0.0/16\",\"170.98.0.0/16\",\"0:0:0:0:0:0:0:1\")"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}