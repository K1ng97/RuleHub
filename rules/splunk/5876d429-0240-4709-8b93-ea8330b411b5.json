{
  "id": "5876d429-0240-4709-8b93-ea8330b411b5",
  "name": "Cobalt Strike Named Pipes",
  "description": "The following analytic detects the use of default or publicly known named pipes associated with Cobalt Strike. It leverages Sysmon EventID 17 and 18 to identify specific named pipes commonly used by Cobalt Strike's Artifact Kit and Malleable C2 Profiles. This activity is significant because Cobalt Strike is a popular tool for adversaries to conduct post-exploitation tasks, and identifying its named pipes can reveal potential malicious activity. If confirmed malicious, this could indicate an active Cobalt Strike beacon, leading to unauthorized access, data exfiltration, or further lateral movement within the network.",
  "source": {
    "type": "splunk",
    "id": "5876d429-0240-4709-8b93-ea8330b411b5",
    "url": "https://github.com/splunk/security_content/blob/develop/cobalt_strike_named_pipes.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/cobalt_strike_named_pipes.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1218/009/",
    "https://docs.microsoft.com/en-us/windows/win32/ipc/named-pipes",
    "https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/index.htm#cshid=1040",
    "https://www.cobaltstrike.com/blog/learn-pipe-fitting-for-all-of-your-offense-projects/",
    "https://gist.github.com/MHaggis/6c600e524045a6d49c35291a21e10752",
    "https://www.mandiant.com/resources/shining-a-light-on-darkside-ransomware-operations"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`sysmon` EventID=17 OR EventID=18 PipeName IN (\\\\msagent_*, \\\\DserNamePipe*, \\\\srvsvc_*, \\\\postex_*, \\\\status_*, \\\\MSSE-*, \\\\spoolss_*, \\\\win_svc*, \\\\ntsvcs*, \\\\winsock*, \\\\UIA_PIPE*) | stats count min(_time) as firstTime max(_time) as lastTime by dest dvc pipe_name process_exec process_guid process_id process_name process_path signature signature_id user_id vendor_product Image PipeName | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `cobalt_strike_named_pipes_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the process name, parent process, and command-line executions from your endpoints. If you are using Sysmon, you must have at least version 6.0.4 of the Sysmon TA.",
    "fields": []
  },
  "falsepositives": [
    "The idea of using named pipes with Cobalt Strike is to blend in. Therefore, some of the named pipes identified and added may cause false positives. Filter by process name or pipe name to reduce false positives."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}