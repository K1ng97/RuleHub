{
  "id": "175bb2de-6227-416b-9678-9b61999cd21f",
  "name": "Windows Enable PowerShell Web Access",
  "description": "The following analytic detects the enabling of PowerShell Web Access via PowerShell commands. It leverages PowerShell script block logging (EventCode 4104) to identify the execution of the `Install-WindowsFeature` cmdlet with the `WindowsPowerShellWebAccess` parameter. This activity is significant because enabling PowerShell Web Access can facilitate remote execution of PowerShell commands, potentially allowing an attacker to gain unauthorized access to systems and networks.",
  "source": {
    "type": "splunk",
    "id": "175bb2de-6227-416b-9678-9b61999cd21f",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_enable_powershell_web_access.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_enable_powershell_web_access.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://www.cisa.gov/news-events/cybersecurity-advisories/aa24-241a",
    "https://gist.github.com/MHaggis/7e67b659af9148fa593cf2402edebb41"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`powershell` EventCode=4104 ScriptBlockText IN (\"*Install-WindowsFeature*WindowsPowerShellWebAccess*\",\"*Install-PswaWebApplication*\",\"*Add-PswaAuthorizationRule*UserName *ComputerName *\") | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest signature signature_id user_id vendor_product EventID Guid Opcode Name Path ProcessID ScriptBlockId ScriptBlockText | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_enable_powershell_web_access_filter`",
    "condition": "To successfully implement this analytic, you will need to enable PowerShell Script Block Logging on some or all endpoints. Additional setup here https://docs.splunk.com/Documentation/UBA/5.0.4.1/GetDataIn/AddPowerShell#Configure_module_logging_for_PowerShell.",
    "fields": []
  },
  "falsepositives": [
    "It is possible that legitimate scripts or network administrators may enable PowerShell Web Access. Monitor and escalate as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}