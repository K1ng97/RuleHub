{
  "id": "6ece9ed0-5f92-4315-889d-48560472b188",
  "name": "Windows Access Token Manipulation SeDebugPrivilege",
  "description": "The following analytic detects a process enabling the \"SeDebugPrivilege\" privilege token. It leverages Windows Security Event Logs with EventCode 4703, filtering out common legitimate processes. This activity is significant because SeDebugPrivilege allows a process to inspect and modify the memory of other processes, potentially leading to credential dumping or code injection. If confirmed malicious, an attacker could gain extensive control over system processes, enabling them to escalate privileges, persist in the environment, or access sensitive information.",
  "source": {
    "type": "splunk",
    "id": "6ece9ed0-5f92-4315-889d-48560472b188",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_access_token_manipulation_sedebugprivilege.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_access_token_manipulation_sedebugprivilege.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://docs.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4703",
    "https://devblogs.microsoft.com/oldnewthing/20080314-00/?p=23113",
    "https://blog.palantir.com/windows-privilege-abuse-auditing-detection-and-defense-3078a403d74e",
    "https://atomicredteam.io/privilege-escalation/T1134.001/#atomic-test-2---%60sedebugprivilege%60-token-duplication",
    "https://malpedia.caad.fkie.fraunhofer.de/details/win.asyncrat"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=4703 EnabledPrivilegeList = \"*SeDebugPrivilege*\" AND NOT(ProcessName IN (\"*\\\\Program File*\", \"*\\\\System32\\\\lsass.exe*\", \"*\\\\SysWOW64\\\\lsass.exe*\", \"*\\\\SysWOW64\\\\svchost.exe*\", \"*\\\\System32\\\\svchost.exe*\")) | stats count min(_time) as firstTime max(_time) as lastTime by Computer ProcessName ProcessId SubjectDomainName SubjectUserName SubjectUserSid TargetUserName TargetLogonId TargetDomainName EnabledPrivilegeList action dest | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_access_token_manipulation_sedebugprivilege_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Windows Security Event Logs with 4703 EventCode enabled. The Windows TA is also required.",
    "fields": []
  },
  "falsepositives": [
    "Some native binaries and browser applications may request SeDebugPrivilege. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}