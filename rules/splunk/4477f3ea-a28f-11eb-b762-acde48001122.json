{
  "id": "4477f3ea-a28f-11eb-b762-acde48001122",
  "name": "Multiple Archive Files Http Post Traffic",
  "description": "The following analytic detects the high-frequency exfiltration of archive files via HTTP POST requests. It leverages HTTP stream logs to identify specific archive file headers within the request body. This activity is significant as it often indicates data exfiltration by APTs or trojan spyware after data collection. If confirmed malicious, this behavior could lead to the unauthorized transfer of sensitive data to an attackerâ€™s command and control server, potentially resulting in severe data breaches and loss of confidential information.",
  "source": {
    "type": "splunk",
    "id": "4477f3ea-a28f-11eb-b762-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/multiple_archive_files_http_post_traffic.yml",
    "file_path": "tmp/repos/splunk/detections/web/multiple_archive_files_http_post_traffic.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Teoderick Contreras, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1560/001/",
    "https://www.mandiant.com/resources/apt39-iranian-cyber-espionage-group-focused-on-personal-information",
    "https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`stream_http` http_method=POST |eval archive_hdr1=substr(form_data,1,2) | eval archive_hdr2 = substr(form_data,1,4) |stats values(form_data) as http_request_body min(_time) as firstTime max(_time) as lastTime count by src_ip dest_ip http_method http_user_agent uri_path url bytes_in bytes_out archive_hdr1 archive_hdr2 |where count >20 AND (archive_hdr1 = \"7z\" OR archive_hdr1 = \"PK\" OR archive_hdr2=\"Rar!\") | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `multiple_archive_files_http_post_traffic_filter`",
    "condition": "To successfully implement this search, you need to be ingesting logs with the stream HTTP logs or network logs that catch network traffic. Make sure that the http-request-body, payload, or request field is enabled in stream http configuration.",
    "fields": []
  },
  "falsepositives": [
    "Normal archive transfer via HTTP protocol may trip this detection."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}