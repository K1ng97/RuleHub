{
  "id": "b84e8f39-4e7b-4d4f-9e7c-fcd29a227845",
  "name": "WS FTP Remote Code Execution",
  "description": "The following analytic detects potential Remote Code Execution (RCE) attempts exploiting CVE-2023-40044 in WS_FTP software. It identifies HTTP POST requests to the \"/AHT/AhtApiService.asmx/AuthUser\" URL with a status code of 200. This detection leverages the Web datamodel to monitor specific URL patterns and HTTP status codes. This activity is significant as it may indicate an exploitation attempt, potentially allowing an attacker to execute arbitrary code on the server. If confirmed malicious, this could lead to unauthorized access, data exfiltration, or further compromise of the affected system.",
  "source": {
    "type": "splunk",
    "id": "b84e8f39-4e7b-4d4f-9e7c-fcd29a227845",
    "url": "https://github.com/splunk/security_content/blob/develop/ws_ftp_remote_code_execution.yml",
    "file_path": "tmp/repos/splunk/detections/web/ws_ftp_remote_code_execution.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "atomic_guid",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://github.com/projectdiscovery/nuclei-templates/pull/8296/files",
    "https://www.assetnote.io/resources/research/rce-in-progress-ws-ftp-ad-hoc-via-iis-http-modules-cve-2023-40044",
    "https://github.com/rapid7/metasploit-framework/pull/18414"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "| tstats count min(_time) as firstTime max(_time) as lastTime from datamodel=Web where Web.url IN (\"/AHT/AhtApiService.asmx/AuthUser\") Web.status=200 Web.http_method=POST by Web.http_user_agent, Web.status Web.http_method, Web.url, Web.url_length, Web.src, Web.dest, sourcetype | `drop_dm_object_name(\"Web\")` | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `ws_ftp_remote_code_execution_filter`",
    "condition": "The following analytic requires the Web datamodel. Ensure data source is mapped correctly or modify and tune for your data source.",
    "fields": []
  },
  "falsepositives": [
    "If WS_FTP Server is not in use, this analytic will not return results. Monitor and tune for your environment. Note the MetaSploit module is focused on only hitting /AHT/ and not the full /AHT/AhtApiService.asmx/AuthUser URL."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}