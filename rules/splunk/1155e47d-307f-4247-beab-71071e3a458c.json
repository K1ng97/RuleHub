{
  "id": "1155e47d-307f-4247-beab-71071e3a458c",
  "name": "Windows AD SID History Attribute Modified",
  "description": "The following analytic detects modifications to the SID History attribute in Active Directory by leveraging event code 5136. This detection uses logs from the `wineventlog_security` data source to identify changes to the sIDHistory attribute. Monitoring this activity is crucial as the SID History attribute can be exploited by adversaries to inherit permissions from other accounts, potentially granting unauthorized access. If confirmed malicious, this activity could allow attackers to maintain persistent access and escalate privileges within the domain, posing a significant security risk.",
  "source": {
    "type": "splunk",
    "id": "1155e47d-307f-4247-beab-71071e3a458c",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_ad_sid_history_attribute_modified.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_ad_sid_history_attribute_modified.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://adsecurity.org/?p=1772",
    "https://learn.microsoft.com/en-us/windows/win32/adschema/a-sidhistory?redirectedfrom=MSDN",
    "https://learn.microsoft.com/en-us/defender-for-identity/security-assessment-unsecure-sid-history-attribute",
    "https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/sid-history-injection"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=5136 AttributeLDAPDisplayName=sIDHistory OperationType=\"%%14674\" | stats values(ObjectDN) as ObjectDN by _time, Computer, SubjectUserName, AttributeValue | rename Computer as dest | `windows_ad_sid_history_attribute_modified_filter`",
    "condition": "To successfully implement this search, you ned to be ingesting eventcode `5136`. The Advanced Security Audit policy setting `Audit Directory Services Changes` within `DS Access` needs to be enabled. Additionally, a SACL needs to be created for AD objects in order to ingest attribute modifications.",
    "fields": []
  },
  "falsepositives": [
    "Domain mergers and migrations may generate large volumes of false positives for this analytic."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}