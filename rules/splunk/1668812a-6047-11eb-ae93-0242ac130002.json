{
  "id": "1668812a-6047-11eb-ae93-0242ac130002",
  "name": "O365 Added Service Principal",
  "description": "The following analytic detects the addition of new service principal accounts in O365 tenants. It leverages data from the `o365_management_activity` dataset, specifically monitoring for operations related to adding or creating service principals. This activity is significant because attackers can exploit service principals to gain unauthorized access and perform malicious actions within an organization's environment. If confirmed malicious, this could allow attackers to interact with APIs, access resources, and execute operations on behalf of the organization, potentially leading to data breaches or further compromise.",
  "source": {
    "type": "splunk",
    "id": "1668812a-6047-11eb-ae93-0242ac130002",
    "url": "https://github.com/splunk/security_content/blob/develop/o365_added_service_principal.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/o365_added_service_principal.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Rod Soto, Splunk",
  "references": [
    "https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/wp-m-unc2452-2021-000343-01.pdf",
    "https://www.cisa.gov/uscert/ncas/alerts/aa21-008a",
    "https://www.splunk.com/en_us/blog/security/a-golden-saml-journey-solarwinds-continued.html",
    "https://blog.sygnia.co/detection-and-hunting-of-golden-saml-attack?hsLang=en"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`o365_management_activity` Workload=AzureActiveDirectory Operation=\"*Add service principal*\" OR (Operation = \"*principal*\" AND action = \"created\") | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by signature dest user src vendor_account vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `o365_added_service_principal_filter`",
    "condition": "You must install splunk Microsoft Office 365 add-on. This search works with o365:management:activity",
    "fields": []
  },
  "falsepositives": [
    "The creation of a new Federation is not necessarily malicious, however these events need to be followed closely, as it may indicate federated credential abuse or backdoor via federated identities at a different cloud provider."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}