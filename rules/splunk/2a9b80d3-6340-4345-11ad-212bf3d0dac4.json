{
  "id": "2a9b80d3-6340-4345-11ad-212bf3d0dac4",
  "name": "AWS SetDefaultPolicyVersion",
  "description": "The following analytic detects when a user sets a default policy version in AWS. It leverages AWS CloudTrail logs to identify the `SetDefaultPolicyVersion` event from the IAM service. This activity is significant because attackers may exploit this technique for privilege escalation, especially if previous policy versions grant more extensive permissions than the current one. If confirmed malicious, this could allow an attacker to gain elevated access to AWS resources, potentially leading to unauthorized actions and data breaches.",
  "source": {
    "type": "splunk",
    "id": "2a9b80d3-6340-4345-11ad-212bf3d0dac4",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_setdefaultpolicyversion.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_setdefaultpolicyversion.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Bhavin Patel, Splunk",
  "references": [
    "https://bishopfox.com/blog/privilege-escalation-in-aws",
    "https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation-part-2/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName=SetDefaultPolicyVersion eventSource = iam.amazonaws.com | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime by signature dest user user_agent src vendor_account vendor_region vendor_product | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `aws_setdefaultpolicyversion_filter`",
    "condition": "You must install splunk AWS add on and Splunk App for AWS. This search works with AWS CloudTrail logs.",
    "fields": []
  },
  "falsepositives": [
    "While this search has no known false positives, it is possible that an AWS admin has legitimately set a default policy to allow a user to access all resources. That said, AWS strongly advises against granting full control to all AWS resources"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}