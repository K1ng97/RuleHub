{
  "id": "ccf6b7a3-bd39-4bc9-a949-143a8d640dbc",
  "name": "CrushFTP Server Side Template Injection",
  "description": "This analytic is designed to identify attempts to exploit a server-side template injection vulnerability in CrushFTP, designated as CVE-2024-4040. This severe vulnerability enables unauthenticated remote attackers to access and read files beyond the VFS Sandbox, circumvent authentication protocols, and execute arbitrary commands on the affected server. The issue impacts all versions of CrushFTP up to 10.7.1 and 11.1.0 on all supported platforms. It is highly recommended to apply patches immediately to prevent unauthorized access to the system and avoid potential data compromises. The search specifically looks for patterns in the raw log data that match the exploitation attempts, including READ or WRITE actions, and extracts relevant information such as the protocol, session ID, user, IP address, HTTP method, and the URI queried. It then evaluates these logs to confirm traces of exploitation based on the presence of specific keywords and the originating IP address, counting and sorting these events for further analysis.",
  "source": {
    "type": "splunk",
    "id": "ccf6b7a3-bd39-4bc9-a949-143a8d640dbc",
    "url": "https://github.com/splunk/security_content/blob/develop/crushftp_server_side_template_injection.yml",
    "file_path": "tmp/repos/splunk/detections/application/crushftp_server_side_template_injection.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://github.com/airbus-cert/CVE-2024-4040",
    "https://www.bleepingcomputer.com/news/security/crushftp-warns-users-to-patch-exploited-zero-day-immediately/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`crushftp` | rex field=_raw \"\\[(?<protocol>HTTPS|HTTP):(?<session_id>[^\\:]+):(?<user>[^\\:]+):(?<src_ip>\\d+\\.\\d+\\.\\d+\\.\\d+)\\] (?<action>READ|WROTE): \\*(?<http_method>[A-Z]+) (?<uri_query>[^\\s]+) HTTP/[^\\*]+\\*\" | eval message=if(match(_raw, \"INCLUDE\") and isnotnull(src_ip), \"traces of exploitation by \" . src_ip, \"false\") | search message!=false | rename host as dest | stats count by _time, dest, source, message, src_ip, http_method, uri_query, user, action | sort -_time| `crushftp_server_side_template_injection_filter`",
    "condition": "CrushFTP Session logs, from Windows or Linux, must be ingested to Splunk. Currently, there is no TA for CrushFTP, so the data must be extracted from the raw logs.",
    "fields": []
  },
  "falsepositives": [
    "False positives should be limited, however tune or filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}