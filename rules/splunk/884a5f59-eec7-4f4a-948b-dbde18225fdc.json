{
  "id": "884a5f59-eec7-4f4a-948b-dbde18225fdc",
  "name": "AWS Detect Users with KMS keys performing encryption S3",
  "description": "The following analytic identifies users with KMS keys performing encryption operations on S3 buckets. It leverages AWS CloudTrail logs to detect the `CopyObject` event where server-side encryption with AWS KMS is specified. This activity is significant as it may indicate unauthorized or suspicious encryption of data, potentially masking exfiltration or tampering efforts. If confirmed malicious, an attacker could be encrypting sensitive data to evade detection or preparing it for exfiltration, posing a significant risk to data integrity and confidentiality.",
  "source": {
    "type": "splunk",
    "id": "884a5f59-eec7-4f4a-948b-dbde18225fdc",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_detect_users_with_kms_keys_performing_encryption_s3.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_detect_users_with_kms_keys_performing_encryption_s3.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Rod Soto, Patrick Bareiss Splunk",
  "references": [
    "https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/",
    "https://github.com/d1vious/git-wild-hunt",
    "https://www.youtube.com/watch?v=PgzNib37g0M"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName=CopyObject requestParameters.x-amz-server-side-encryption=\"aws:kms\" | rename requestParameters.bucketName AS bucketName, requestParameters.x-amz-copy-source AS src_file, requestParameters.key AS dest_file | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime by signature dest user user_agent src vendor_account vendor_region vendor_product bucketName src_file dest_file | `security_content_ctime(firstTime)`| `security_content_ctime(lastTime)`| `aws_detect_users_with_kms_keys_performing_encryption_s3_filter`",
    "condition": "You must install Splunk AWS add on and Splunk App for AWS. This search works with AWS CloudTrail logs",
    "fields": []
  },
  "falsepositives": [
    "There maybe buckets provisioned with S3 encryption"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}