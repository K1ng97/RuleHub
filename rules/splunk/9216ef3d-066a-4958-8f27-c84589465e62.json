{
  "id": "9216ef3d-066a-4958-8f27-c84589465e62",
  "name": "Windows Driver Load Non-Standard Path",
  "description": "The following analytic detects the loading of new Kernel Mode Drivers from non-standard paths using Windows EventCode 7045. It identifies drivers not located in typical directories like Windows, Program Files, or SystemRoot. This activity is significant because adversaries may use these non-standard paths to load malicious or vulnerable drivers, potentially bypassing security controls. If confirmed malicious, this could allow attackers to execute code at the kernel level, escalate privileges, or maintain persistence within the environment, posing a severe threat to system integrity and security.",
  "source": {
    "type": "splunk",
    "id": "9216ef3d-066a-4958-8f27-c84589465e62",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_driver_load_non_standard_path.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_driver_load_non_standard_path.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://redcanary.com/blog/tracking-driver-inventory-to-expose-rootkits/",
    "https://attack.mitre.org/techniques/T1014/",
    "https://www.fuzzysecurity.com/tutorials/28.html"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_system` EventCode=7045 ServiceType=\"kernel mode driver\" | regex ImagePath!=\"(?i)^(\\w:\\\\\\\\Windows\\\\\\\\|\\w:\\\\\\\\Program\\sFile|\\\\\\\\systemroot\\\\\\\\|%SystemRoot%|system32\\\\\\\\|\\\\\\\\ProgramData\\\\\\\\Microsoft\\\\\\\\Windows\\sDefender\\\\\\\\Definition\\sUpdates\\\\\\\\)\" | stats count min(_time) as firstTime max(_time) as lastTime by Computer EventCode ImagePath ServiceName ServiceType  | rename Computer as dest  | `security_content_ctime(firstTime)`  | `security_content_ctime(lastTime)`  | `windows_driver_load_non_standard_path_filter`",
    "condition": "To implement this analytic, the Windows EventCode 7045 will need to be logged. The Windows TA for Splunk is also recommended.",
    "fields": []
  },
  "falsepositives": [
    "False positives may be present based on legitimate third party applications needing to install drivers. Filter, or allow list known good drivers consistently being installed in these paths."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}