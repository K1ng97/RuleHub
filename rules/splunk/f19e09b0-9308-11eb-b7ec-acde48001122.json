{
  "id": "f19e09b0-9308-11eb-b7ec-acde48001122",
  "name": "AWS IAM Assume Role Policy Brute Force",
  "description": "The following analytic detects multiple failed attempts to assume an AWS IAM role, indicating a potential brute force attack. It leverages AWS CloudTrail logs to identify `MalformedPolicyDocumentException` errors with a status of `failure` and filters out legitimate AWS services. This activity is significant as repeated failures to assume roles can indicate an adversary attempting to guess role names, which is a precursor to unauthorized access. If confirmed malicious, this could lead to unauthorized access to AWS resources, potentially compromising sensitive data and services.",
  "source": {
    "type": "splunk",
    "id": "f19e09b0-9308-11eb-b7ec-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_iam_assume_role_policy_brute_force.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_iam_assume_role_policy_brute_force.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Michael Haag, Splunk",
  "references": [
    "https://www.praetorian.com/blog/aws-iam-assume-role-vulnerabilities/",
    "https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/",
    "https://www.elastic.co/guide/en/security/current/aws-iam-brute-force-of-assume-role-policy.html"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` (errorCode=MalformedPolicyDocumentException) status=failure (userAgent!=*.amazonaws.com) | rename user_name as user | stats count min(_time) as firstTime max(_time) as lastTime values(requestParameters.policyName) as policy_name by src, user, vendor_account vendor_region, vendor_product, signature, dest, errorCode | where count >= 2 | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `aws_iam_assume_role_policy_brute_force_filter`",
    "condition": "The Splunk AWS Add-on and Splunk App for AWS is required to utilize this data. The search requires AWS CloudTrail logs. Set the `where count` greater than a value to identify suspicious activity in your environment.",
    "fields": []
  },
  "falsepositives": [
    "This detection will require tuning to provide high fidelity detection capabilties. Tune based on src addresses (corporate offices, VPN terminations) or by groups of users."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}