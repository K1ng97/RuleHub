{
  "id": "51c04fdb-2746-465a-b86e-b413a09c9085",
  "name": "AWS Concurrent Sessions From Different Ips",
  "description": "The following analytic identifies an AWS IAM account with concurrent sessions originating from more than one unique IP address within a 5-minute window. It leverages AWS CloudTrail logs, specifically the `DescribeEventAggregates` event, to detect this behavior. This activity is significant as it may indicate a session hijacking attack, where an adversary uses stolen session cookies to access AWS resources from a different location. If confirmed malicious, this could allow unauthorized access to sensitive corporate resources, leading to potential data breaches or further exploitation within the AWS environment.",
  "source": {
    "type": "splunk",
    "id": "51c04fdb-2746-465a-b86e-b413a09c9085",
    "url": "https://github.com/splunk/security_content/blob/develop/aws_concurrent_sessions_from_different_ips.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/aws_concurrent_sessions_from_different_ips.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Bhavin Patel, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1185/",
    "https://breakdev.org/evilginx-2-next-generation-of-phishing-2fa-tokens/",
    "https://github.com/kgretzky/evilginx2"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`cloudtrail` eventName = DescribeEventAggregates src_ip!=\"AWS Internal\" | bin span=5m _time | rename user_name as user | stats min(_time) as firstTime max(_time) as lastTime values(user_agent) as user_agent values(signature) as signature values(src) as src values(dest) as dest dc(src) as distinct_ip_count by _time user vendor_account vendor_region vendor_product | where distinct_ip_count > 1 |  `security_content_ctime(firstTime)` |`security_content_ctime(lastTime)` | `aws_concurrent_sessions_from_different_ips_filter`",
    "condition": "You must install Splunk AWS Add on and Splunk App for AWS. This search works with AWS CloudTrail logs.",
    "fields": []
  },
  "falsepositives": [
    "A user with concurrent sessions from different Ips may also represent the legitimate use of more than one device. Filter as needed and/or customize the threshold to fit your environment."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}