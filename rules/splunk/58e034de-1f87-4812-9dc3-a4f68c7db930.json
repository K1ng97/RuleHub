{
  "id": "58e034de-1f87-4812-9dc3-a4f68c7db930",
  "name": "O365 Concurrent Sessions From Different Ips",
  "description": "The following analytic identifies user sessions in Office 365 accessed from multiple IP addresses, indicating potential adversary-in-the-middle (AiTM) phishing attacks. It detects this activity by analyzing Azure Active Directory logs for 'UserLoggedIn' operations and flags sessions with more than one associated IP address. This behavior is significant as it suggests unauthorized concurrent access, which is uncommon in normal usage. If confirmed malicious, the impact could include data theft, account takeover, and the launching of internal phishing campaigns, posing severe risks to organizational security.",
  "source": {
    "type": "splunk",
    "id": "58e034de-1f87-4812-9dc3-a4f68c7db930",
    "url": "https://github.com/splunk/security_content/blob/develop/o365_concurrent_sessions_from_different_ips.yml",
    "file_path": "tmp/repos/splunk/detections/cloud/o365_concurrent_sessions_from_different_ips.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://attack.mitre.org/techniques/T1185/",
    "https://breakdev.org/evilginx-2-next-generation-of-phishing-2fa-tokens/",
    "https://github.com/kgretzky/evilginx2"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`o365_management_activity` Workload=AzureActiveDirectory Operation=UserLoggedIn | fillnull | stats count min(_time) as firstTime max(_time) as lastTime values(src) as src by signature dest user vendor_account vendor_product | where mvcount(src) > 1 | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `o365_concurrent_sessions_from_different_ips_filter`",
    "condition": "You must install splunk Microsoft Office 365 add-on. This search works with o365:management:activity",
    "fields": []
  },
  "falsepositives": [
    "Unknown"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}