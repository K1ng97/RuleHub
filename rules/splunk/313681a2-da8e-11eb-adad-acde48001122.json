{
  "id": "313681a2-da8e-11eb-adad-acde48001122",
  "name": "Print Spooler Adding A Printer Driver",
  "description": "The following analytic detects the addition of new printer drivers by monitoring Windows PrintService operational logs, specifically EventCode 316. This detection leverages log data to identify messages indicating the addition or update of printer drivers, such as \"kernelbase.dll\" and \"UNIDRV.DLL.\" This activity is significant as it may indicate exploitation attempts related to vulnerabilities like CVE-2021-34527 (PrintNightmare). If confirmed malicious, attackers could gain code execution or escalate privileges, potentially compromising the affected system. Immediate isolation and investigation of the endpoint are recommended.",
  "source": {
    "type": "splunk",
    "id": "313681a2-da8e-11eb-adad-acde48001122",
    "url": "https://github.com/splunk/security_content/blob/develop/print_spooler_adding_a_printer_driver.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/print_spooler_adding_a_printer_driver.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "cve",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Michael Haag, Teoderick Contreras, Splunk",
  "references": [
    "https://twitter.com/MalwareJake/status/1410421445608476679?s=20",
    "https://www.truesec.com/hub/blog/fix-for-printnightmare-cve-2021-1675-exploit-to-keep-your-print-servers-running-while-a-patch-is-not-available",
    "https://www.truesec.com/hub/blog/exploitable-critical-rce-vulnerability-allows-regular-users-to-fully-compromise-active-directory-printnightmare-cve-2021-1675",
    "https://www.reddit.com/r/msp/comments/ob6y02/critical_vulnerability_printnightmare_exposes"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`printservice` EventCode=316 category = \"Adding a printer driver\" Message = \"*kernelbase.dll,*\" Message = \"*UNIDRV.DLL,*\" Message = \"*.DLL.*\" | stats  count min(_time) as firstTime max(_time) as lastTime by OpCode EventCode ComputerName Message | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `print_spooler_adding_a_printer_driver_filter`",
    "condition": "You will need to ensure PrintService Admin and Operational logs are being logged to Splunk from critical or all systems.",
    "fields": []
  },
  "falsepositives": [
    "Unknown. This may require filtering."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}