{
  "id": "5cc67381-44fa-4111-8a37-7a230943f027",
  "name": "Kerberoasting spn request with RC4 encryption",
  "description": "The following analytic detects potential Kerberoasting attacks by identifying Kerberos service ticket requests with RC4 encryption through Event ID 4769. It leverages specific Ticket_Options values commonly used by Kerberoasting tools. This activity is significant as Kerberoasting allows attackers to request service tickets for domain accounts, typically service accounts, and crack them offline to gain privileged access. If confirmed malicious, this could lead to unauthorized access, privilege escalation, and further compromise of the Active Directory environment.",
  "source": {
    "type": "splunk",
    "id": "5cc67381-44fa-4111-8a37-7a230943f027",
    "url": "https://github.com/splunk/security_content/blob/develop/kerberoasting_spn_request_with_rc4_encryption.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/kerberoasting_spn_request_with_rc4_encryption.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Jose Hernandez, Patrick Bareiss, Mauricio Velazco, Dean Luxton, Splunk",
  "references": [
    "https://github.com/redcanaryco/atomic-red-team/blob/4e3e9c8096dde00639a6b98845ec349135554ed5/atomics/T1208/T1208.md",
    "https://www.hub.trimarcsecurity.com/post/trimarc-research-detecting-kerberoasting-activity"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`wineventlog_security` EventCode=4769 ServiceName!=\"*$\" (TicketOptions=0x40810000 OR TicketOptions=0x40800000 OR TicketOptions=0x40810010) TicketEncryptionType=0x17 | stats count min(_time) as firstTime max(_time) as lastTime by Computer, user, service_id, service, TicketEncryptionType, TicketOptions | rename Computer as dest | `security_content_ctime(lastTime)` | `security_content_ctime(firstTime)` | `kerberoasting_spn_request_with_rc4_encryption_filter`",
    "condition": "To successfully implement this search, you need to be ingesting Domain Controller and Kerberos events. The Advanced Security Audit policy setting `Audit Kerberos Authentication Service` within `Account Logon` needs to be enabled. Whithin environments where this type of communication is common, consider dropping the risk score and add throttling based on the user and service_id for 30 days. This will allow RBA to alert when there is an anomalous spike of these kerberoastable SPN requests within a short period of time.",
    "fields": []
  },
  "falsepositives": [
    "Older systems that support kerberos RC4 by default like NetApp may generate false positives. Filter as needed"
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}