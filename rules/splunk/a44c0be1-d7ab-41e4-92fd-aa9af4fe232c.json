{
  "id": "a44c0be1-d7ab-41e4-92fd-aa9af4fe232c",
  "name": "Windows File Share Discovery With Powerview",
  "description": "The following analytic detects the execution of the Invoke-ShareFinder PowerShell cmdlet from PowerView. This detection leverages PowerShell Script Block Logging to identify instances where this specific command is executed. Monitoring this activity is crucial as it indicates an attempt to enumerate network file shares, which may contain sensitive information such as backups, scripts, and credentials. If confirmed malicious, this activity could enable an attacker to escalate privileges or move laterally within the network, potentially compromising additional systems and sensitive data.",
  "source": {
    "type": "splunk",
    "id": "a44c0be1-d7ab-41e4-92fd-aa9af4fe232c",
    "url": "https://github.com/splunk/security_content/blob/develop/windows_file_share_discovery_with_powerview.yml",
    "file_path": "tmp/repos/splunk/detections/endpoint/windows_file_share_discovery_with_powerview.yml"
  },
  "tags": [
    "analytic_story",
    "asset_type",
    "mitre_attack_id",
    "product",
    "security_domain"
  ],
  "author": "Mauricio Velazco, Splunk",
  "references": [
    "https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerView/powerview.ps1",
    "https://thedfirreport.com/2023/01/23/sharefinder-how-threat-actors-discover-file-shares/",
    "https://attack.mitre.org/techniques/T1135/"
  ],
  "severity": "medium",
  "type": "splunk",
  "status": "production",
  "created": "2025-05-02",
  "modified": "2025-05-02",
  "mitre": {
    "tactics": [],
    "techniques": []
  },
  "detection": {
    "query": "`powershell` EventCode=4104  (ScriptBlockText=Invoke-ShareFinder*) | fillnull | stats count min(_time) as firstTime max(_time) as lastTime by dest signature signature_id user_id vendor_product EventID Guid Opcode Name Path ProcessID ScriptBlockId ScriptBlockText | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` | `windows_file_share_discovery_with_powerview_filter`",
    "condition": "To successfully implement this analytic, you will need to enable PowerShell Script Block Logging on some or all endpoints. Additional setup here https://docs.splunk.com/Documentation/UBA/5.0.4.1/GetDataIn/AddPowerShell#Configure_module_logging_for_PowerShell.=",
    "fields": []
  },
  "falsepositives": [
    "Security teams may leverage PowerView proactively to identify and remediate sensitive file shares. Filter as needed."
  ],
  "level": "medium",
  "rule_format": "standard",
  "platforms": [],
  "data_sources": []
}